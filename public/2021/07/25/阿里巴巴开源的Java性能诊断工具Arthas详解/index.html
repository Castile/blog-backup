<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>阿里巴巴开源的Java性能诊断工具Arthas详解 | Castile</title><meta name="description" content="一、ArthasArthas 是Alibaba开源的Java诊断工具，深受开发者喜爱。 当你遇到以下类似问题而束手无策时，Arthas可以帮助你解决：  这个类从哪个 jar 包加载的？为什么会报各种类相关的 Exception？ 我改的代码为什么没有执行到？难道是我没 commit？分支搞错了？ 遇到问题无法在线上 debug，难道只能通过加日志再重新发布吗？ 线上遇到某个用户的数据处理有问题，"><meta property="og:type" content="article"><meta property="og:title" content="阿里巴巴开源的Java性能诊断工具Arthas详解"><meta property="og:url" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/index.html"><meta property="og:site_name" content="Castile"><meta property="og:description" content="一、ArthasArthas 是Alibaba开源的Java诊断工具，深受开发者喜爱。 当你遇到以下类似问题而束手无策时，Arthas可以帮助你解决：  这个类从哪个 jar 包加载的？为什么会报各种类相关的 Exception？ 我改的代码为什么没有执行到？难道是我没 commit？分支搞错了？ 遇到问题无法在线上 debug，难道只能通过加日志再重新发布吗？ 线上遇到某个用户的数据处理有问题，"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://img.shields.io/maven-central/v/com.taobao.arthas/arthas-packaging.svg?style=flat-square"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626505201869.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626505589443.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626506001436.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626506236303.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626509042267.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626510139591.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626510324269.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626512647773.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626514227687.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626514828921.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626514851368.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626514992047.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626516068279.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626516191083.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626517078834.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626517607909.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626529130220.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626531356962.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626531485542.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626531726921.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626533128923.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626533435556.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626537037313.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626537314248.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626537438540.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626537404225.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626576723307.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626576966746.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626577463368.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626581994840.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626582118394.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626584425202.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626584539103.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626584640497.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626584764553.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626584867367.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626585063811.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626585179744.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626586964556.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626587115355.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626588168229.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626588540360.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626591019239.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626591664645.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626591823165.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626591945850.png"><meta property="og:image" content="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626595368642.png"><meta property="article:published_time" content="2021-07-25T08:15:00.000Z"><meta property="article:modified_time" content="2021-07-25T08:54:52.189Z"><meta property="article:author" content="朱宏梁"><meta property="article:tag" content="Java"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.shields.io/maven-central/v/com.taobao.arthas/arthas-packaging.svg?style=flat-square"><link rel="canonical" href="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/index.html"><link rel="alternate" href="/atom.xml" title="Castile" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"></head><body class="main-center theme-green" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/castile" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">朱宏梁</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">Research &amp; Develop</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Dongguan, China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">首页</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">归档</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">分类</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">标签</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">项目</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">书单</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">友链</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">关于</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/castile" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="https://gitee.com/hongliangzhu" target="_blank" title="Gitee" data-toggle="tooltip" data-placement="top"><i class="icon icon-gitee"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">公告</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">分类</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CleanCode/">CleanCode</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flink/">Flink</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaWeb/">JavaWeb</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E9%AB%98%E5%B9%B6%E5%8F%91/">Java高并发</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MyBatis/">MyBatis</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Netty/">Netty</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NiFi/">NiFi</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Problems/">Problems</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RPC/">RPC</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringBoot/">SpringBoot</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ZooKeeper/">ZooKeeper</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring/">spring</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">人工智能</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9B%BE%E8%AE%A1%E7%AE%97/">图计算</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/">论文阅读</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/">领域驱动设计</a><span class="category-list-count">5</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Attention/" rel="tag">Attention</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DDD/" rel="tag">DDD</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flink/" rel="tag">Flink</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Http/" rel="tag">Http</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IO/" rel="tag">IO</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaWeb/" rel="tag">JavaWeb</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java%E5%9F%BA%E7%A1%80/" rel="tag">Java基础</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lambda/" rel="tag">Lambda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NIO/" rel="tag">NIO</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Netty/" rel="tag">Netty</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NiFi/" rel="tag">NiFi</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Operator-Chain/" rel="tag">Operator Chain</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pytorch/" rel="tag">Pytorch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPC/" rel="tag">RPC</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/" rel="tag">RabbitMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSL/" rel="tag">SSL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Servlet/" rel="tag">Servlet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Slots/" rel="tag">Slots</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stateless/" rel="tag">Stateless</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thread/" rel="tag">Thread</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UVOS/" rel="tag">UVOS</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VOS/" rel="tag">VOS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ZooKeeper/" rel="tag">ZooKeeper</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aop/" rel="tag">aop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bfs/" rel="tag">bfs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/" rel="tag">blog</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/" rel="tag">centos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/davis/" rel="tag">davis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dfs/" rel="tag">dfs</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dp/" rel="tag">dp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/errors/" rel="tag">errors</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/excel/" rel="tag">excel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flink/" rel="tag">flink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gc/" rel="tag">gc</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hosts/" rel="tag">hosts</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/" rel="tag">https</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/io/" rel="tag">io</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java%E5%9F%BA%E7%A1%80/" rel="tag">java基础</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/juc/" rel="tag">juc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/" rel="tag">jvm</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/latex/" rel="tag">latex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/matlab/" rel="tag">matlab</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/" rel="tag">maven</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mq/" rel="tag">mq</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nebula/" rel="tag">nebula</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nifi/" rel="tag">nifi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/papers/" rel="tag">papers</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/plugin/" rel="tag">plugin</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/refactory/" rel="tag">refactory</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rpc/" rel="tag">rpc</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-batch/" rel="tag">spring-batch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh%E5%85%8D%E5%AF%86/" rel="tag">ssh免密</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/" rel="tag">ssl</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/synchronized/" rel="tag">synchronized</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/" rel="tag">tools</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/topK/" rel="tag">topK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/volatile/" rel="tag">volatile</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E7%AD%89/" rel="tag">中等</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8C%E5%88%86/" rel="tag">二分</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" rel="tag">二叉树</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" rel="tag">人工智能</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BD%8D%E6%93%8D%E4%BD%9C/" rel="tag">位操作</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%B3%E9%94%AE%E5%AD%97/" rel="tag">关键字</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="tag">函数式编程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8C%E6%8C%87%E9%92%88/" rel="tag">双指针</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%B0%84/" rel="tag">反射</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%93%88%E5%B8%8C/" rel="tag">哈希</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%B0%E9%9A%BE/" rel="tag">困难</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">图数据库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" rel="tag">字符串</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91/" rel="tag">并发</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/" rel="tag">并查集</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/" rel="tag">归并排序</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/" rel="tag">快速排序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%88%98%E6%9C%AF%E8%AE%BE%E8%AE%A1/" rel="tag">战术设计</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%88%98%E7%95%A5%E8%AE%BE%E8%AE%A1/" rel="tag">战略设计</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">排序</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8F%92%E4%BB%B6/" rel="tag">插件</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%90%9C%E7%B4%A2/" rel="tag">搜索</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E5%AD%A6/" rel="tag">数学</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E9%9B%86/" rel="tag">数据集</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E7%BB%84/" rel="tag">数组</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E6%A1%A3/" rel="tag">文档</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%A1%E6%8B%9B/" rel="tag">校招</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A8%A1%E6%9D%BF/" rel="tag">模板</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">消息中间件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A7%92%E6%9D%80%E9%A1%B9%E7%9B%AE/" rel="tag">秒杀项目</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AC%94%E8%AF%95/" rel="tag">笔试</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%80%E5%8D%95/" rel="tag">简单</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E5%AD%90/" rel="tag">算子</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%AF%E5%87%BD%E6%95%B0/" rel="tag">纯函数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E7%A8%8B/" rel="tag">线程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%81%9A%E5%90%88/" rel="tag">聚合</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%81%9A%E5%90%88%E7%AE%97%E5%AD%90/" rel="tag">聚合算子</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%85%BE%E8%AE%AF/" rel="tag">腾讯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B4%AA%E5%BF%83/" rel="tag">贪心</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81/" rel="tag">身份验证</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E5%A4%8D%E6%9D%82%E6%80%A7/" rel="tag">软件复杂性</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%92%E5%BD%92/" rel="tag">递归</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%93%BE%E8%A1%A8/" rel="tag">链表</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%94%81/" rel="tag">锁</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%99%90%E7%95%8C%E4%B8%8A%E4%B8%8B%E6%96%87/" rel="tag">限界上下文</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" rel="tag">领域驱动设计</a><span class="tag-list-count">5</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签云</h3><div class="widget-body tagcloud"><a href="/tags/Attention/" style="font-size:13.08px">Attention</a> <a href="/tags/DDD/" style="font-size:13.33px">DDD</a> <a href="/tags/Flink/" style="font-size:13.17px">Flink</a> <a href="/tags/Http/" style="font-size:13px">Http</a> <a href="/tags/IO/" style="font-size:13px">IO</a> <a href="/tags/JVM/" style="font-size:13px">JVM</a> <a href="/tags/Java/" style="font-size:13.92px">Java</a> <a href="/tags/JavaWeb/" style="font-size:13.25px">JavaWeb</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size:13.08px">Java基础</a> <a href="/tags/Lambda/" style="font-size:13px">Lambda</a> <a href="/tags/Mysql/" style="font-size:13.08px">Mysql</a> <a href="/tags/NIO/" style="font-size:13.08px">NIO</a> <a href="/tags/Netty/" style="font-size:13.33px">Netty</a> <a href="/tags/NiFi/" style="font-size:13.33px">NiFi</a> <a href="/tags/Operator-Chain/" style="font-size:13px">Operator Chain</a> <a href="/tags/Pytorch/" style="font-size:13px">Pytorch</a> <a href="/tags/RPC/" style="font-size:13.17px">RPC</a> <a href="/tags/RabbitMQ/" style="font-size:13px">RabbitMQ</a> <a href="/tags/SSL/" style="font-size:13px">SSL</a> <a href="/tags/Servlet/" style="font-size:13px">Servlet</a> <a href="/tags/Slots/" style="font-size:13px">Slots</a> <a href="/tags/SpringBoot/" style="font-size:13.08px">SpringBoot</a> <a href="/tags/Stateless/" style="font-size:13px">Stateless</a> <a href="/tags/Thread/" style="font-size:13.08px">Thread</a> <a href="/tags/UVOS/" style="font-size:13.17px">UVOS</a> <a href="/tags/VOS/" style="font-size:13px">VOS</a> <a href="/tags/ZooKeeper/" style="font-size:13.08px">ZooKeeper</a> <a href="/tags/aop/" style="font-size:13px">aop</a> <a href="/tags/bfs/" style="font-size:13px">bfs</a> <a href="/tags/blog/" style="font-size:13px">blog</a> <a href="/tags/centos/" style="font-size:13px">centos</a> <a href="/tags/davis/" style="font-size:13px">davis</a> <a href="/tags/dfs/" style="font-size:13.42px">dfs</a> <a href="/tags/dp/" style="font-size:13.17px">dp</a> <a href="/tags/errors/" style="font-size:13.17px">errors</a> <a href="/tags/excel/" style="font-size:13px">excel</a> <a href="/tags/flink/" style="font-size:13px">flink</a> <a href="/tags/gc/" style="font-size:13.08px">gc</a> <a href="/tags/hosts/" style="font-size:13px">hosts</a> <a href="/tags/https/" style="font-size:13px">https</a> <a href="/tags/io/" style="font-size:13px">io</a> <a href="/tags/java%E5%9F%BA%E7%A1%80/" style="font-size:13px">java基础</a> <a href="/tags/juc/" style="font-size:13px">juc</a> <a href="/tags/jvm/" style="font-size:13.33px">jvm</a> <a href="/tags/latex/" style="font-size:13px">latex</a> <a href="/tags/linux/" style="font-size:13.08px">linux</a> <a href="/tags/matlab/" style="font-size:13px">matlab</a> <a href="/tags/maven/" style="font-size:13px">maven</a> <a href="/tags/mq/" style="font-size:13px">mq</a> <a href="/tags/mybatis/" style="font-size:13.5px">mybatis</a> <a href="/tags/mysql/" style="font-size:13.33px">mysql</a> <a href="/tags/nebula/" style="font-size:13px">nebula</a> <a href="/tags/nifi/" style="font-size:13px">nifi</a> <a href="/tags/papers/" style="font-size:13.67px">papers</a> <a href="/tags/plugin/" style="font-size:13.17px">plugin</a> <a href="/tags/redis/" style="font-size:13.17px">redis</a> <a href="/tags/refactory/" style="font-size:13px">refactory</a> <a href="/tags/rpc/" style="font-size:13.08px">rpc</a> <a href="/tags/spring/" style="font-size:13.17px">spring</a> <a href="/tags/spring-batch/" style="font-size:13px">spring-batch</a> <a href="/tags/ssh%E5%85%8D%E5%AF%86/" style="font-size:13px">ssh免密</a> <a href="/tags/ssl/" style="font-size:13.08px">ssl</a> <a href="/tags/synchronized/" style="font-size:13px">synchronized</a> <a href="/tags/tools/" style="font-size:13px">tools</a> <a href="/tags/topK/" style="font-size:13px">topK</a> <a href="/tags/volatile/" style="font-size:13px">volatile</a> <a href="/tags/web/" style="font-size:13px">web</a> <a href="/tags/%E4%B8%AD%E7%AD%89/" style="font-size:13.83px">中等</a> <a href="/tags/%E4%BA%8C%E5%88%86/" style="font-size:13px">二分</a> <a href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" style="font-size:13px">二叉树</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size:13.17px">人工智能</a> <a href="/tags/%E4%BD%8D%E6%93%8D%E4%BD%9C/" style="font-size:13px">位操作</a> <a href="/tags/%E5%85%B3%E9%94%AE%E5%AD%97/" style="font-size:13px">关键字</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size:13px">函数式编程</a> <a href="/tags/%E5%8F%8C%E6%8C%87%E9%92%88/" style="font-size:13px">双指针</a> <a href="/tags/%E5%8F%8D%E5%B0%84/" style="font-size:13px">反射</a> <a href="/tags/%E5%93%88%E5%B8%8C/" style="font-size:13px">哈希</a> <a href="/tags/%E5%9B%B0%E9%9A%BE/" style="font-size:13.42px">困难</a> <a href="/tags/%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size:13px">图数据库</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size:13.17px">多线程</a> <a href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size:13.08px">字符串</a> <a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size:13px">并发</a> <a href="/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/" style="font-size:13.42px">并查集</a> <a href="/tags/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/" style="font-size:13.08px">归并排序</a> <a href="/tags/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/" style="font-size:13px">快速排序</a> <a href="/tags/%E6%88%98%E6%9C%AF%E8%AE%BE%E8%AE%A1/" style="font-size:13px">战术设计</a> <a href="/tags/%E6%88%98%E7%95%A5%E8%AE%BE%E8%AE%A1/" style="font-size:13px">战略设计</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size:13px">排序</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size:13.17px">插件</a> <a href="/tags/%E6%90%9C%E7%B4%A2/" style="font-size:13.33px">搜索</a> <a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size:13.08px">数学</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size:13px">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size:13px">数据结构</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E9%9B%86/" style="font-size:13px">数据集</a> <a href="/tags/%E6%95%B0%E7%BB%84/" style="font-size:13.33px">数组</a> <a href="/tags/%E6%96%87%E6%A1%A3/" style="font-size:13px">文档</a> <a href="/tags/%E6%A0%A1%E6%8B%9B/" style="font-size:13px">校招</a> <a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size:13px">模板</a> <a href="/tags/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size:13px">消息中间件</a> <a href="/tags/%E7%A7%92%E6%9D%80%E9%A1%B9%E7%9B%AE/" style="font-size:13.08px">秒杀项目</a> <a href="/tags/%E7%AC%94%E8%AF%95/" style="font-size:13px">笔试</a> <a href="/tags/%E7%AE%80%E5%8D%95/" style="font-size:13.58px">简单</a> <a href="/tags/%E7%AE%97%E5%AD%90/" style="font-size:13px">算子</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:14px">算法</a> <a href="/tags/%E7%BA%AF%E5%87%BD%E6%95%B0/" style="font-size:13px">纯函数</a> <a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size:13px">线程</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size:13px">网络</a> <a href="/tags/%E8%81%9A%E5%90%88/" style="font-size:13px">聚合</a> <a href="/tags/%E8%81%9A%E5%90%88%E7%AE%97%E5%AD%90/" style="font-size:13px">聚合算子</a> <a href="/tags/%E8%85%BE%E8%AE%AF/" style="font-size:13px">腾讯</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size:13.33px">设计模式</a> <a href="/tags/%E8%B4%AA%E5%BF%83/" style="font-size:13px">贪心</a> <a href="/tags/%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81/" style="font-size:13px">身份验证</a> <a href="/tags/%E8%BD%AF%E4%BB%B6%E5%A4%8D%E6%9D%82%E6%80%A7/" style="font-size:13px">软件复杂性</a> <a href="/tags/%E9%80%92%E5%BD%92/" style="font-size:13.75px">递归</a> <a href="/tags/%E9%93%BE%E8%A1%A8/" style="font-size:13.17px">链表</a> <a href="/tags/%E9%94%81/" style="font-size:13px">锁</a> <a href="/tags/%E9%99%90%E7%95%8C%E4%B8%8A%E4%B8%8B%E6%96%87/" style="font-size:13.08px">限界上下文</a> <a href="/tags/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" style="font-size:13.33px">领域驱动设计</a></div></div><div class="widget"><h3 class="widget-title">归档</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">十一月 2024</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">六月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">四月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">十月 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">九月 2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">六月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">三月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a><span class="archive-list-count">26</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">12</span></li></ul></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/">领域驱动设计</a></p><p class="item-title"><a href="/2024/11/11/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A105-%E8%AF%86%E5%88%AB%E9%99%90%E7%95%8C%E4%B8%8A%E4%B8%8B%E6%96%87/" class="title">领域驱动设计05-识别限界上下文</a></p><p class="item-date"><time datetime="2024-11-11T15:45:16.000Z" itemprop="datePublished">2024-11-11</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%9B%BE%E8%AE%A1%E7%AE%97/">图计算</a></p><p class="item-title"><a href="/2024/11/07/nebula%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93/" class="title">nebula图数据库</a></p><p class="item-date"><time datetime="2024-11-07T14:04:28.000Z" itemprop="datePublished">2024-11-07</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/Java%E9%AB%98%E5%B9%B6%E5%8F%91/">Java高并发</a></p><p class="item-title"><a href="/2024/11/07/%E5%9B%9B%E5%A4%A7%E5%BC%95%E7%94%A8/" class="title">Java四大引用类型</a></p><p class="item-date"><time datetime="2024-11-07T12:48:59.496Z" itemprop="datePublished">2024-11-07</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></p><p class="item-title"><a href="/2024/11/07/%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="title">设计模式-单例设计模式</a></p><p class="item-date"><time datetime="2024-11-07T12:48:59.495Z" itemprop="datePublished">2024-11-07</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/Java%E9%AB%98%E5%B9%B6%E5%8F%91/">Java高并发</a></p><p class="item-title"><a href="/2024/11/07/theadlocal/" class="title">初探ThreadLocal</a></p><p class="item-date"><time datetime="2024-11-07T12:48:59.481Z" itemprop="datePublished">2024-11-07</time></p></div></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><nav id="toc" class="article-toc"><h3 class="toc-title">文章目录</h3><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Arthas"><span class="toc-number">1.</span> <span class="toc-text">一、Arthas</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">二、安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8arthas-boot%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">使用arthas-boot（推荐）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8as-sh"><span class="toc-number">2.2.</span> <span class="toc-text">使用as.sh</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E9%87%8F%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.</span> <span class="toc-text">全量安装</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%BF%AB%E9%80%9F%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">三、快速使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%90%AF%E5%8A%A8math-game"><span class="toc-number">3.1.</span> <span class="toc-text">1. 启动math-game</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%90%AF%E5%8A%A8arthas"><span class="toc-number">3.2.</span> <span class="toc-text">2. 启动arthas</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">四、常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">命令介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-dashboard%E4%BB%AA%E8%A1%A8%E7%9B%98"><span class="toc-number">4.1.1.</span> <span class="toc-text">1. dashboard仪表盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%80%9A%E8%BF%87thread%E5%91%BD%E4%BB%A4%E6%9D%A5%E8%8E%B7%E5%8F%96%E5%88%B0arthas-demo%E8%BF%9B%E7%A8%8B%E7%9A%84Main-Class"><span class="toc-number">4.1.2.</span> <span class="toc-text">2. 通过thread命令来获取到arthas-demo进程的Main Class</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%80%9A%E8%BF%87jad%E5%8F%8D%E7%BC%96%E8%AF%91Main-Class"><span class="toc-number">4.1.3.</span> <span class="toc-text">3. 通过jad反编译Main Class</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-watch%E7%9B%91%E8%A7%86-%EF%BC%88debug%EF%BC%89"><span class="toc-number">4.1.4.</span> <span class="toc-text">4. watch监视 （debug）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%80%80%E5%87%BAarthas"><span class="toc-number">4.1.5.</span> <span class="toc-text">5. 退出arthas</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4"><span class="toc-number">5.</span> <span class="toc-text">五、基础命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81JVM%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">6.</span> <span class="toc-text">六、JVM相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87"><span class="toc-number">6.1.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-dashboard"><span class="toc-number">6.2.</span> <span class="toc-text">1. dashboard</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%AF%B4%E6%98%8E"><span class="toc-number">6.2.1.</span> <span class="toc-text">数据说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JVM%E5%86%85%E9%83%A8%E7%BA%BF%E7%A8%8B"><span class="toc-number">6.2.2.</span> <span class="toc-text">JVM内部线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JIT%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91"><span class="toc-number">6.2.3.</span> <span class="toc-text">JIT即时编译</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-thread"><span class="toc-number">6.3.</span> <span class="toc-text">2. thread</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cpu%E4%BD%BF%E7%94%A8%E7%8E%87%E6%98%AF%E5%A6%82%E4%BD%95%E7%BB%9F%E8%AE%A1%E5%87%BA%E6%9D%A5%E7%9A%84%EF%BC%9F"><span class="toc-number">6.3.1.</span> <span class="toc-text">cpu使用率是如何统计出来的？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B"><span class="toc-number">6.3.2.</span> <span class="toc-text">举例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E6%B2%A1%E6%9C%89%E5%8F%82%E6%95%B0%E6%97%B6%EF%BC%8C%E6%98%BE%E7%A4%BA%E7%AC%AC%E4%B8%80%E9%A1%B5%E7%BA%BF%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">6.3.3.</span> <span class="toc-text">当没有参数时，显示第一页线程信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#thread-%E2%80%93all-%E6%98%BE%E7%A4%BA%E6%89%80%E6%9C%89%E5%8C%B9%E9%85%8D%E7%9A%84%E7%BA%BF%E7%A8%8B"><span class="toc-number">6.3.4.</span> <span class="toc-text">thread –all, 显示所有匹配的线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#thread-id%EF%BC%8C-%E6%98%BE%E7%A4%BA%E6%8C%87%E5%AE%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E8%BF%90%E8%A1%8C%E5%A0%86%E6%A0%88"><span class="toc-number">6.3.5.</span> <span class="toc-text">thread id， 显示指定线程的运行堆栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#thread-i-%E6%8C%87%E5%AE%9A%E9%87%87%E6%A0%B7%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94"><span class="toc-number">6.3.6.</span> <span class="toc-text">thread -i, 指定采样时间间隔</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#thread-%E2%80%93state-%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E7%8A%B6%E6%80%81%E7%9A%84%E7%BA%BF%E7%A8%8B"><span class="toc-number">6.3.7.</span> <span class="toc-text">thread –state ，查看指定状态的线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#thread-b-%E6%89%BE%E5%87%BA%E5%BD%93%E5%89%8D%E9%98%BB%E5%A1%9E%E5%85%B6%E4%BB%96%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%BA%BF%E7%A8%8B"><span class="toc-number">6.3.8.</span> <span class="toc-text">thread -b, 找出当前阻塞其他线程的线程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-jvm-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8DJVM%E4%BF%A1%E6%81%AF"><span class="toc-number">6.4.</span> <span class="toc-text">3. jvm 查看当前JVM信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#THREAD%E7%9B%B8%E5%85%B3"><span class="toc-number">6.4.1.</span> <span class="toc-text">THREAD相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E7%9B%B8%E5%85%B3"><span class="toc-number">6.4.2.</span> <span class="toc-text">文件描述符相关</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-sysprop-%E7%B3%BB%E7%BB%9F%E5%B1%9E%E6%80%A7%E7%9B%B8%E5%85%B3"><span class="toc-number">6.5.</span> <span class="toc-text">4. sysprop 系统属性相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8D%95%E4%B8%AA%E5%B1%9E%E6%80%A7"><span class="toc-number">6.5.1.</span> <span class="toc-text">查看单个属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%8D%95%E4%B8%AA%E5%B1%9E%E6%80%A7"><span class="toc-number">6.5.2.</span> <span class="toc-text">修改单个属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-sysenv-%E6%9F%A5%E7%9C%8Bjvm%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF"><span class="toc-number">6.6.</span> <span class="toc-text">5. sysenv 查看jvm环境信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-vmoption%E6%9F%A5%E7%9C%8B%EF%BC%8C%E6%9B%B4%E6%96%B0VM%E8%AF%8A%E6%96%AD%E7%9B%B8%E5%85%B3%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">6.7.</span> <span class="toc-text">6. vmoption查看，更新VM诊断相关的参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-getstatic%E6%9F%A5%E7%9C%8B%E7%B1%BB%E7%9A%84%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7"><span class="toc-number">6.8.</span> <span class="toc-text">7. getstatic查看类的静态属性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81Class-ClassLoader%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">7.</span> <span class="toc-text">八、Class&#x2F;ClassLoader相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87-1"><span class="toc-number">7.1.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-sc%E6%9F%A5%E7%9C%8BJVM%E5%B7%B2%E5%8A%A0%E8%BD%BD%E7%9A%84%E7%B1%BB%E4%BF%A1%E6%81%AF"><span class="toc-number">7.2.</span> <span class="toc-text">1. sc查看JVM已加载的类信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-sm%E6%9F%A5%E7%9C%8B%E5%B7%B2%E5%8A%A0%E8%BD%BD%E7%B1%BB%E7%9A%84%E6%96%B9%E6%B3%95%E4%BF%A1%E6%81%AF"><span class="toc-number">7.3.</span> <span class="toc-text">2. sm查看已加载类的方法信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-jad-%E6%8A%8A%E5%AD%97%E8%8A%82%E7%A0%81%E5%8F%8D%E7%BC%96%E8%AF%91%E6%88%90%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-number">7.4.</span> <span class="toc-text">3. jad: 把字节码反编译成源代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91java-lang-String"><span class="toc-number">7.4.1.</span> <span class="toc-text">反编译java.lang.String</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91%E6%97%B6%E5%8F%AA%E6%98%BE%E7%A4%BA%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-number">7.4.2.</span> <span class="toc-text">反编译时只显示源代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91%E6%97%B6%E6%8C%87%E5%AE%9AClassLoader"><span class="toc-number">7.4.3.</span> <span class="toc-text">反编译时指定ClassLoader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91%E6%8C%87%E5%AE%9A%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.4.</span> <span class="toc-text">反编译指定的函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-mc%E5%86%85%E5%AD%98%E7%BC%96%E8%AF%91"><span class="toc-number">7.5.</span> <span class="toc-text">4. mc内存编译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-redefine"><span class="toc-number">7.6.</span> <span class="toc-text">5. redefine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">7.6.1.</span> <span class="toc-text">常见问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redefine%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">7.6.2.</span> <span class="toc-text">redefine的限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%E7%83%AD%E6%9B%B4%E6%96%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">7.6.3.</span> <span class="toc-text">举例热更新代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%87%86%E5%A4%87"><span class="toc-number">7.6.3.1.</span> <span class="toc-text">源码准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jad%E5%8F%8D%E7%BC%96%E8%AF%91"><span class="toc-number">7.6.3.2.</span> <span class="toc-text">jad反编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sc%E6%9F%A5%E6%89%BE%E5%8A%A0%E8%BD%BDPrintNum%E7%9A%84ClassLoader"><span class="toc-number">7.6.3.3.</span> <span class="toc-text">sc查找加载PrintNum的ClassLoader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mc%E7%BC%96%E8%AF%91"><span class="toc-number">7.6.3.4.</span> <span class="toc-text">mc编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redefine"><span class="toc-number">7.6.3.5.</span> <span class="toc-text">redefine</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%EF%BC%9A%E4%BD%BF%E7%94%A8jad%E7%AD%89%E5%91%BD%E4%BB%A4%E5%AF%BC%E8%87%B4%E9%87%8D%E7%BD%AE"><span class="toc-number">7.6.3.6.</span> <span class="toc-text">注：使用jad等命令导致重置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-dump"><span class="toc-number">7.7.</span> <span class="toc-text">6. dump</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-classloader"><span class="toc-number">7.8.</span> <span class="toc-text">7. classloader</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E5%A2%9E%E5%BC%BA%E5%91%BD%E4%BB%A4"><span class="toc-number">8.</span> <span class="toc-text">九、增强命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87-2"><span class="toc-number">8.1.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-monitor%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E7%9B%91%E6%8E%A7"><span class="toc-number">8.2.</span> <span class="toc-text">1. monitor方法执行监控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7%E7%9A%84%E7%BB%B4%E5%BA%A6%E8%AF%B4%E6%98%8E"><span class="toc-number">8.2.1.</span> <span class="toc-text">监控的维度说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-watch-%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%95%B0%E6%8D%AE%E8%A7%82%E6%B5%8B"><span class="toc-number">8.3.</span> <span class="toc-text">2. watch 方法执行数据观测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">8.3.1.</span> <span class="toc-text">参数说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B-1"><span class="toc-number">8.3.2.</span> <span class="toc-text">举例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-trace-%E6%96%B9%E6%B3%95%E5%86%85%E9%83%A8%E8%B0%83%E7%94%A8%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA"><span class="toc-number">8.4.</span> <span class="toc-text">3. trace 方法内部调用路径追踪</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-1"><span class="toc-number">8.4.1.</span> <span class="toc-text">参数说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B-2"><span class="toc-number">8.4.2.</span> <span class="toc-text">举例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-stack%E8%BE%93%E5%87%BA%E5%BD%93%E5%89%8D%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8%E8%B7%AF%E5%BE%84"><span class="toc-number">8.5.</span> <span class="toc-text">4. stack输出当前方法的调用路径</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-2"><span class="toc-number">8.5.1.</span> <span class="toc-text">参数说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B-3"><span class="toc-number">8.5.2.</span> <span class="toc-text">举例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-tt-%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%95%B0%E6%8D%AE%E7%9A%84%E6%97%B6%E7%A9%BA%E9%9A%A7%E9%81%93"><span class="toc-number">8.6.</span> <span class="toc-text">5. tt 方法执行数据的时空隧道</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B-4"><span class="toc-number">8.6.1.</span> <span class="toc-text">举例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-profiler"><span class="toc-number">8.7.</span> <span class="toc-text">6. profiler</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-3"><span class="toc-number">8.7.1.</span> <span class="toc-text">参数说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E9%87%87%E6%A0%B7"><span class="toc-number">8.7.2.</span> <span class="toc-text">开始采样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%B7%B2%E9%87%87%E9%9B%86%E7%9A%84sample%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-number">8.7.3.</span> <span class="toc-text">获取已采集的sample的数量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bprofiler%E7%8A%B6%E6%80%81"><span class="toc-number">8.7.4.</span> <span class="toc-text">查看profiler状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2profiler"><span class="toc-number">8.7.5.</span> <span class="toc-text">停止profiler</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90svg%E6%A0%BC%E5%BC%8F%E7%BB%93%E6%9E%9C"><span class="toc-number">8.7.5.1.</span> <span class="toc-text">生成svg格式结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90html%E6%A0%BC%E5%BC%8F%E7%BB%93%E6%9E%9C"><span class="toc-number">8.7.5.2.</span> <span class="toc-text">生成html格式结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%81%AB%E7%84%B0%E5%9B%BE%E7%9A%84%E5%90%AB%E4%B9%89"><span class="toc-number">8.7.5.3.</span> <span class="toc-text">火焰图的含义</span></a></li></ol></li></ol></li></ol></li></ol></nav></div></aside><main class="main" role="main"><div class="content"><article id="post-阿里巴巴开源的Java性能诊断工具Arthas详解" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">阿里巴巴开源的Java性能诊断工具Arthas详解</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/" class="article-date"><time datetime="2021-07-25T08:15:00.000Z" itemprop="datePublished">2021-07-25</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/Java/">Java</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/Java/" rel="tag">Java</a> </span><span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span> </span></span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/#comments" class="article-comment-link">评论</a></span> <span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 11.1k(字)</span> <span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 46(分)</span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h1 id="一、Arthas"><a href="#一、Arthas" class="headerlink" title="一、Arthas"></a>一、Arthas</h1><p><code>Arthas</code> 是Alibaba开源的Java诊断工具，深受开发者喜爱。</p><p>当你遇到以下类似问题而束手无策时，<code>Arthas</code>可以帮助你解决：</p><ol><li>这个类从哪个 jar 包加载的？为什么会报各种类相关的 Exception？</li><li>我改的代码为什么没有执行到？难道是我没 commit？分支搞错了？</li><li>遇到问题无法在线上 debug，难道只能通过加日志再重新发布吗？</li><li>线上遇到某个用户的数据处理有问题，但线上同样无法 debug，线下无法重现！</li><li>是否有一个全局视角来查看系统的运行状况？</li><li>有什么办法可以监控到JVM的实时运行状态？</li><li>怎么快速定位应用的热点，生成火焰图？</li><li>怎样直接从JVM内查找某个类的实例？</li></ol><p><code>Arthas</code>支持JDK6+，支持Linux/Mac/Windows，采用命令行交互模式，同时提供丰富的 <code>Tab</code> 自动补全功能，进一步方便进行问题的定位和诊断。</p><h1 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h1><h2 id="使用arthas-boot（推荐）"><a href="#使用arthas-boot（推荐）" class="headerlink" title="使用arthas-boot（推荐）"></a>使用<code>arthas-boot</code>（推荐）</h2><p>下载<code>arthas-boot.jar</code>，然后用<code>java -jar</code>的方式启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://arthas.aliyun.com/arthas-boot.jar</span><br><span class="line">java -jar arthas-boot.jar</span><br></pre></td></tr></table></figure><p>打印帮助信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar arthas-boot.jar -h</span><br></pre></td></tr></table></figure><ul><li><p>如果下载速度比较慢，可以使用aliyun的镜像：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar arthas-boot.jar --repo-mirror aliyun --use-http</span><br></pre></td></tr></table></figure></li></ul><h2 id="使用as-sh"><a href="#使用as-sh" class="headerlink" title="使用as.sh"></a>使用<code>as.sh</code></h2><p>Arthas 支持在 Linux/Unix/Mac 等平台上一键安装，请复制以下内容，并粘贴到命令行中，敲 <code>回车</code> 执行即可：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://arthas.aliyun.com/install.sh | sh</span><br></pre></td></tr></table></figure><p>上述命令会下载启动脚本文件 <code>as.sh</code> 到当前目录，你可以放在任何地方或将其加入到 <code>$PATH</code> 中。</p><p>直接在shell下面执行<code>./as.sh</code>，就会进入交互界面。</p><p>也可以执行<code>./as.sh -h</code>来获取更多参数信息。</p><h2 id="全量安装"><a href="#全量安装" class="headerlink" title="全量安装"></a>全量安装</h2><p>最新版本，点击下载：<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/download/latest_version?mirror=aliyun"><img src="https://img.shields.io/maven-central/v/com.taobao.arthas/arthas-packaging.svg?style=flat-square" alt="Arthas"></a></p><p>解压后，在文件夹里有<code>arthas-boot.jar</code>，直接用<code>java -jar</code>的方式启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar arthas-boot.jar</span><br></pre></td></tr></table></figure><h1 id="三、快速使用"><a href="#三、快速使用" class="headerlink" title="三、快速使用"></a>三、快速使用</h1><h2 id="1-启动math-game"><a href="#1-启动math-game" class="headerlink" title="1. 启动math-game"></a>1. 启动math-game</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://arthas.aliyun.com/math-game.jar</span><br><span class="line">java -jar math-game.jar</span><br></pre></td></tr></table></figure><p><code>math-game</code>是一个简单的程序，每隔一秒生成一个随机数，再执行质因数分解，并打印出分解结果。</p><p><code>math-game</code>源代码：<a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/blob/master/math-game/src/main/java/demo/MathGame.java">查看</a></p><h2 id="2-启动arthas"><a href="#2-启动arthas" class="headerlink" title="2. 启动arthas"></a>2. 启动arthas</h2><p>在命令行下面执行（使用和目标进程一致的用户启动，否则可能attach失败）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://arthas.aliyun.com/arthas-boot.jar</span><br><span class="line">java -jar arthas-boot.jar</span><br></pre></td></tr></table></figure><ul><li>执行该程序的用户需要和目标进程具有相同的权限。比如以<code>admin</code>用户来执行：<code>sudo su admin &amp;&amp; java -jar arthas-boot.jar</code> 或 <code>sudo -u admin -EH java -jar arthas-boot.jar</code>。</li><li>如果attach不上目标进程，可以查看<code>~/logs/arthas/</code> 目录下的日志。</li><li>如果下载速度比较慢，可以使用aliyun的镜像：<code>java -jar arthas-boot.jar --repo-mirror aliyun --use-http</code></li><li><code>java -jar arthas-boot.jar -h</code> 打印更多参数信息。</li></ul><p>选择应用java进程：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ $ java -jar arthas-boot.jar</span><br><span class="line">* [1]: 35542</span><br><span class="line">  [2]: 71560 math-game.jar</span><br></pre></td></tr></table></figure><p><code>math-game</code>进程是第2个，则输入2，再输入<code>回车/enter</code>。Arthas会attach到目标进程上，并输出日志</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626505201869.png" width="1626505201869"><h1 id="四、常用命令"><a href="#四、常用命令" class="headerlink" title="四、常用命令"></a>四、常用命令</h1><ol><li>dashboard仪表盘</li><li>通过thread命令来获取到arthas-demo进程的Main Class</li><li>通过jad反编译Main Class</li><li>watch</li></ol><h2 id="命令介绍"><a href="#命令介绍" class="headerlink" title="命令介绍"></a>命令介绍</h2><h3 id="1-dashboard仪表盘"><a href="#1-dashboard仪表盘" class="headerlink" title="1. dashboard仪表盘"></a>1. dashboard仪表盘</h3><p>输入<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/dashboard.html">dashboard</a>，按<code>回车/enter</code>，会展示当前进程的信息，按<code>ctrl+c</code>可以中断执行。</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626505589443.png" width="1626505589443"><ol><li>第一部分是显示JVM中运行的所有线程：所在的线程组，优先级，线程的状态，CPU的利用率，是否是后台进程等。</li><li>第二部分显示的是JVM内存的使用情况等</li><li>第三部分是操作系统的一些信息和Java版本号</li></ol><ul><li>ID: Java级别的线程ID，注意这个ID不能跟jstack中的nativeID一一对应。</li><li>NAME: 线程名</li><li>GROUP: 线程组名</li><li>PRIORITY: 线程优先级, 1~10之间的数字，越大表示优先级越高</li><li>STATE: 线程的状态</li><li>CPU%: 线程的cpu使用率。比如采样间隔1000ms，某个线程的增量cpu时间为100ms，则cpu使用率=100/1000=10%</li><li>DELTA_TIME: 上次采样之后线程运行增量CPU时间，数据格式为<code>秒</code></li><li>TIME: 线程运行总CPU时间，数据格式为<code>分:秒</code></li><li>INTERRUPTED: 线程当前的中断位状态</li><li>DAEMON: 是否是daemon线程</li></ul><h3 id="2-通过thread命令来获取到arthas-demo进程的Main-Class"><a href="#2-通过thread命令来获取到arthas-demo进程的Main-Class" class="headerlink" title="2. 通过thread命令来获取到arthas-demo进程的Main Class"></a>2. 通过thread命令来获取到arthas-demo进程的Main Class</h3><p>获取到arthas-demo进程的Main Class</p><p>thread 1 会打印线程ID为1 的栈信息，通常是main函数的线程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Threads Total: 24, NEW: 0, RUNNABLE: 7, BLOCKED: 0, WAITING: 4, TIMED_WAITING: 3, TERMINATED: 0, Internal threads: 10</span><br><span class="line">ID      NAME                                              GROUP                    PRIORITY         STATE            %CPU            DELTA_TIME       TIME             INTERRUPTED     DAEMON</span><br><span class="line">-1      VM Periodic Task Thread                           -                        -1               -                0.13            0.000            0:0.804          false           true</span><br><span class="line">22      arthas-command-execute                            system                   5                RUNNABLE         0.09            0.000            0:0.004          false           true</span><br><span class="line">-1      C1 CompilerThread2                                -                        -1               -                0.06            0.000            0:0.587          false           true</span><br><span class="line">2       Reference Handler                                 system                   10               WAITING          0.0             0.000            0:0.001          false           true</span><br><span class="line">3       Finalizer                                         system                   8                WAITING          0.0             0.000            0:0.004          false           true</span><br><span class="line">4       Signal Dispatcher                                 system                   9                RUNNABLE         0.0             0.000            0:0.000          false           true</span><br><span class="line">9       Attach Listener                                   system                   9                RUNNABLE         0.0             0.000            0:0.010          false           true</span><br><span class="line">11      arthas-timer                                      system                   9                WAITING          0.0             0.000            0:0.000          false           true</span><br><span class="line">14      arthas-NettyHttpTelnetBootstrap-3-1               system                   5                RUNNABLE         0.0             0.000            0:0.020          false           true</span><br><span class="line">15      arthas-NettyWebsocketTtyBootstrap-4-1             system                   5                RUNNABLE         0.0             0.000            0:0.001          false           true</span><br><span class="line">16      arthas-NettyWebsocketTtyBootstrap-4-2             system                   5                RUNNABLE         0.0             0.000            0:0.002          false           true</span><br><span class="line">17      arthas-shell-server                               system                   9                TIMED_WAITING    0.0             0.000            0:0.002          false           true</span><br><span class="line">18      arthas-session-manager                            system                   9                TIMED_WAITING    0.0             0.000            0:0.001          false           true</span><br><span class="line">19      arthas-UserStat                                   system                   9                WAITING          0.0             0.000            0:0.000          false           true</span><br><span class="line">21      arthas-NettyHttpTelnetBootstrap-3-2               system                   5                RUNNABLE         0.0             0.000            0:0.200          false           true</span><br><span class="line">1       main                                              main                     5                TIMED_WAITING    0.0             0.000            0:0.230          false           false</span><br><span class="line">-1      GC task thread#1 (ParallelGC)                     -                        -1               -                0.0             0.000            0:0.030          false           true</span><br><span class="line">-1      VM Thread                                         -                        -1               -                0.0             0.000            0:0.152          false           true</span><br><span class="line">-1      GC task thread#2 (ParallelGC)                     -                        -1               -                0.0             0.000            0:0.031          false           true</span><br><span class="line">-1      GC task thread#3 (ParallelGC)                     -                        -1               -                0.0             0.000            0:0.030          false           true</span><br><span class="line">-1      GC task thread#0 (ParallelGC)                     -                        -1               -                0.0             0.000            0:0.028          false           true</span><br><span class="line">-1      C2 CompilerThread0                                -                        -1               -                0.0             0.000            0:0.704          false           true</span><br><span class="line">-1      Service Thread                                    -                        -1               -                0.0             0.000            0:0.000          false           true</span><br><span class="line">-1      C2 CompilerThread1                                -                        -1               -                0.0             0.000            0:0.535          false           true</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread 1</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626506001436.png" width="1626506001436"><h3 id="3-通过jad反编译Main-Class"><a href="#3-通过jad反编译Main-Class" class="headerlink" title="3. 通过jad反编译Main Class"></a>3. 通过jad反编译Main Class</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jad demo.MathGame</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626506236303.png" width="1626506236303"><h3 id="4-watch监视-（debug）"><a href="#4-watch监视-（debug）" class="headerlink" title="4. watch监视 （debug）"></a>4. watch监视 （debug）</h3><p>通过watch命令来查看<code>demo.MathGame#primeFactors</code> 函数的返回值</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors returnObj</span><br><span class="line">		包名+类名      函数名		ongl表达式</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@29058]$</span><span class="bash"> watch demo.MathGame primeFactors returnObj</span></span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost in 77 ms, listenerId: 1</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExceptionExit</span><br><span class="line">ts=2021-07-17 15:22:29; [cost=0.58359ms] result=null</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExit</span><br><span class="line">ts=2021-07-17 15:22:30; [cost=0.09676ms] result=@ArrayList[</span><br><span class="line">    @Integer[2], # 第一个整数</span><br><span class="line">    @Integer[7],</span><br><span class="line">    @Integer[11],</span><br><span class="line">    @Integer[557],</span><br><span class="line">]</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExit</span><br><span class="line">ts=2021-07-17 15:22:31; [cost=0.03972ms] result=@ArrayList[</span><br><span class="line">    @Integer[2],</span><br><span class="line">    @Integer[3],</span><br><span class="line">    @Integer[17],</span><br><span class="line">    @Integer[1151],</span><br><span class="line">]</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExceptionExit</span><br><span class="line">ts=2021-07-17 15:22:32; [cost=0.049295ms] result=null # 不能分解</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExit</span><br><span class="line">ts=2021-07-17 15:22:33; [cost=0.763201ms] result=@ArrayList[</span><br><span class="line">    @Integer[65809],</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-退出arthas"><a href="#5-退出arthas" class="headerlink" title="5. 退出arthas"></a>5. 退出arthas</h3><p>如果只是退出当前的连接，可以用<code>quit</code>或者<code>exit</code>命令。Attach到目标进程上的arthas还会继续运行，端口会保持开放，下次连接时可以直接连接上。</p><p>如果想完全退出arthas，可以执行<code>stop</code>命令。</p><h1 id="五、基础命令"><a href="#五、基础命令" class="headerlink" title="五、基础命令"></a>五、基础命令</h1><ul><li><p>help——查看命令帮助信息</p></li><li><p><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/cat.html">cat</a>——打印文件内容，和linux里的cat命令类似</p></li><li><p><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/echo.html">echo</a>–打印参数，和linux里的echo命令类似</p></li><li><p><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/grep.html">grep</a>——匹配查找，和linux里的grep命令类似</p><p>但是它只能用于管道命令</p><p>语法：</p><hr><table><thead><tr><th align="center">参数列表</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">-n</td><td align="center">显示行号</td></tr><tr><td align="center">-i</td><td align="center">忽略大小写查找</td></tr><tr><td align="center">-m 行数</td><td align="center">最大显示行数，要与查询字符串一起使用</td></tr><tr><td align="center">-e “正则表达式”</td><td align="center">使用正则表达式查找</td></tr></tbody></table><p>如：</p><ol><li><p>只显示包含java字符串的行系统属性</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysprop | grep java</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626509042267.png" width="1626509042267"></li><li><p>只显示10行，并显示出行号</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysprop | grep java -n -m10</span><br></pre></td></tr></table></figure></li></ol></li><li><p><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/base64.html">base64</a>——base64编码转换，和linux里的base64命令类似</p></li><li><p><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/tee.html">tee</a>——复制标准输入到标准输出和指定的文件，和linux里的tee命令类似</p><p>tee指令会从标准输入设备读取数据，将其内容输出到标准输出设备，同时保存成文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXAMPLES:</span><br><span class="line">  sysprop | tee /path/to/logfile | grep java</span><br><span class="line">  sysprop | tee -a /path/to/logfile | grep java</span><br></pre></td></tr></table></figure><p>-a 参数是追加到文件</p></li><li><p><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/pwd.html">pwd</a>——返回当前的工作目录，和linux命令类似</p></li><li><p>cls——清空当前屏幕区域</p></li><li><p>session——查看当前会话的信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Name        Value</span><br><span class="line">--------------------------------------------------</span><br><span class="line"> JAVA_PID    29058</span><br><span class="line"> SESSION_ID  dfad3e36-c62f-49b4-906f-494f030a5c50</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/reset.html">reset</a>——重置增强类，将被 Arthas 增强过的类全部还原，Arthas 服务端关闭时会重置所有增强过的类。</p><blockquote><p>Arthas在 watch/trace 等命令时，实际上是修改了应用的字节码，插入增强的代码。显式执行 <code>reset</code> 命令，可以清除掉这些增强代码。</p></blockquote><p>语法：</p><p>1、 还原指定类：reset Test</p><p>2、还原所有以List结尾的类：reset *List</p><p>3、还原所有的类：reset</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626510139591.png" width="1626510139591"></li><li><p>version——输出当前目标 Java 进程所加载的 Arthas 版本号</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@29058]$</span><span class="bash"> version</span></span><br><span class="line">3.5.2</span><br></pre></td></tr></table></figure></li><li><p>history——打印命令历史</p></li><li><p>quit——退出当前 Arthas 客户端，其他 Arthas 客户端不受影响</p></li><li><p>stop——关闭 Arthas 服务端，所有 Arthas 客户端全部退出</p></li><li><p><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/keymap.html">keymap</a>——Arthas快捷键列表及自定义快捷键</p><table><thead><tr><th>快捷键</th><th>快捷键说明</th><th>命令名称</th><th>命令说明</th></tr></thead><tbody><tr><td><code>&quot;\C-a&quot;</code></td><td>ctrl + a</td><td>beginning-of-line</td><td>跳到行首</td></tr><tr><td><code>&quot;\C-e&quot;</code></td><td>ctrl + e</td><td>end-of-line</td><td>跳到行尾</td></tr><tr><td><code>&quot;\C-f&quot;</code></td><td>ctrl + f</td><td>forward-word</td><td>向前移动一个单词</td></tr><tr><td><code>&quot;\C-b&quot;</code></td><td>ctrl + b</td><td>backward-word</td><td>向后移动一个单词</td></tr><tr><td><code>&quot;\e[D&quot;</code></td><td>键盘左方向键</td><td>backward-char</td><td>光标向前移动一个字符</td></tr><tr><td><code>&quot;\e[C&quot;</code></td><td>键盘右方向键</td><td>forward-char</td><td>光标向后移动一个字符</td></tr><tr><td><code>&quot;\e[B&quot;</code></td><td>键盘下方向键</td><td>next-history</td><td>下翻显示下一个命令</td></tr><tr><td><code>&quot;\e[A&quot;</code></td><td>键盘上方向键</td><td>previous-history</td><td>上翻显示上一个命令</td></tr><tr><td><code>&quot;\C-h&quot;</code></td><td>ctrl + h</td><td>backward-delete-char</td><td>向后删除一个字符</td></tr><tr><td><code>&quot;\C-?&quot;</code></td><td>ctrl + shift + /</td><td>backward-delete-char</td><td>向后删除一个字符</td></tr><tr><td><code>&quot;\C-u&quot;</code></td><td>ctrl + u</td><td>undo</td><td>撤销上一个命令，相当于清空当前行</td></tr><tr><td><code>&quot;\C-d&quot;</code></td><td>ctrl + d</td><td>delete-char</td><td>删除当前光标所在字符</td></tr><tr><td><code>&quot;\C-k&quot;</code></td><td>ctrl + k</td><td>kill-line</td><td>删除当前光标到行尾的所有字符</td></tr><tr><td><code>&quot;\C-i&quot;</code></td><td>ctrl + i</td><td>complete</td><td>自动补全，相当于敲<code>TAB</code></td></tr><tr><td><code>&quot;\C-j&quot;</code></td><td>ctrl + j</td><td>accept-line</td><td>结束当前行，相当于敲回车</td></tr><tr><td><code>&quot;\C-m&quot;</code></td><td>ctrl + m</td><td>accept-line</td><td>结束当前行，相当于敲回车</td></tr><tr><td><code>&quot;\C-w&quot;</code></td><td></td><td>backward-delete-word</td><td></td></tr><tr><td><code>&quot;\C-x\e[3~&quot;</code></td><td></td><td>backward-kill-line</td><td></td></tr><tr><td><code>&quot;\e\C-?&quot;</code></td><td></td><td>backward-kill-word</td><td></td></tr></tbody></table><ul><li>任何时候 <code>tab</code> 键，会根据当前的输入给出提示</li><li>命令后敲 <code>-</code> 或 <code>--</code> ，然后按 <code>tab</code> 键，可以展示出此命令具体的选项</li></ul><p>中文版：供参考</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626510324269.png" width="1626510324269"></li></ul><h1 id="六、JVM相关命令"><a href="#六、JVM相关命令" class="headerlink" title="六、JVM相关命令"></a>六、JVM相关命令</h1><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ol><li>dashboard 仪表板</li><li>thread 线程相关</li><li>jvm虚拟机相关</li><li>sysprop 系统属性相关</li><li>sysenv 查看jvm环境信息</li></ol><h2 id="1-dashboard"><a href="#1-dashboard" class="headerlink" title="1. dashboard"></a>1. dashboard</h2><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626512647773.png" width="1626512647773"><h3 id="数据说明"><a href="#数据说明" class="headerlink" title="数据说明"></a>数据说明</h3><ul><li>ID: Java级别的线程ID，注意这个ID不能跟jstack中的nativeID一一对应。</li><li>NAME: 线程名</li><li>GROUP: 线程组名</li><li>PRIORITY: 线程优先级, 1~10之间的数字，越大表示优先级越高</li><li>STATE: 线程的状态</li><li>CPU%: 线程的cpu使用率。比如采样间隔1000ms，某个线程的增量cpu时间为100ms，则cpu使用率=100/1000=10%</li><li>DELTA_TIME: 上次采样之后线程运行增量CPU时间，数据格式为<code>秒</code></li><li>TIME: 线程运行总CPU时间，数据格式为<code>分:秒</code></li><li>INTERRUPTED: 线程当前的中断位状态</li><li>DAEMON: 是否是daemon线程</li></ul><h3 id="JVM内部线程"><a href="#JVM内部线程" class="headerlink" title="JVM内部线程"></a>JVM内部线程</h3><p>Java 8之后支持获取JVM内部线程CPU时间，这些线程只有名称和CPU时间，没有ID及状态等信息（显示ID为-1）。 通过内部线程可以观测到JVM活动，如GC、JIT编译等占用CPU情况，方便了解JVM整体运行状况。</p><ul><li>当JVM 堆(heap)/元数据(metaspace)空间不足或OOM时，可以看到GC线程的CPU占用率明显高于其他的线程。</li><li>当执行<code>trace/watch/tt/redefine</code>等命令后，可以看到JIT线程活动变得更频繁。因为JVM热更新class字节码时清除了此class相关的JIT编译结果，需要重新编译。</li></ul><p>JVM内部线程包括下面几种：</p><ul><li>JIT编译线程: 如 <code>C1 CompilerThread0</code>, <code>C2 CompilerThread0</code></li><li>GC线程: 如<code>GC Thread0</code>, <code>G1 Young RemSet Sampling</code></li><li>其它内部线程: 如<code>VM Periodic Task Thread</code>, <code>VM Thread</code>, <code>Service Thread</code></li></ul><h3 id="JIT即时编译"><a href="#JIT即时编译" class="headerlink" title="JIT即时编译"></a>JIT即时编译</h3><p>JIT是just in time的缩写，也就是即时编译。通过JIT技术，能够做到Java程序执行速度的加速。</p><p>注： JIT即时编译： <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34902684/article/details/85538895">https://blog.csdn.net/qq_34902684/article/details/85538895</a></p><h2 id="2-thread"><a href="#2-thread" class="headerlink" title="2. thread"></a>2. thread</h2><p>查看当前JVM的线程堆栈信息（ 查看当前线程信息，查看线程的堆栈 ）</p><p>参数说明：</p><table><thead><tr><th align="center">参数名称</th><th align="center">参数说明</th></tr></thead><tbody><tr><td align="center">id</td><td align="center">线程id</td></tr><tr><td align="center">[n:]</td><td align="center">指定最忙的前N个线程并打印堆栈</td></tr><tr><td align="center">[b]</td><td align="center">找出当前阻塞其他线程的线程</td></tr><tr><td align="center">[i ]</td><td align="center">指定cpu占比统计的采样间隔，单位为毫秒指定cpu使用率统计的采样间隔，，默认值为200</td></tr><tr><td align="center">[–all]</td><td align="center">显示所有匹配的线程</td></tr></tbody></table><h3 id="cpu使用率是如何统计出来的？"><a href="#cpu使用率是如何统计出来的？" class="headerlink" title="cpu使用率是如何统计出来的？"></a>cpu使用率是如何统计出来的？</h3><p>这里的cpu使用率与linux 命令<code>top -H -p</code> 的线程<code>%CPU</code>类似，一段采样间隔时间内，当前JVM里各个线程的增量cpu时间与采样间隔时间的比例。</p><blockquote><p>工作原理说明：</p></blockquote><ul><li>首先第一次采样，获取所有线程的CPU时间(调用的是<code>java.lang.management.ThreadMXBean#getThreadCpuTime()</code>及<code>sun.management.HotspotThreadMBean.getInternalThreadCpuTimes()</code>接口)</li><li>然后睡眠等待一个间隔时间（默认为200ms，可以通过<code>-i</code>指定间隔时间）</li><li>再次第二次采样，获取所有线程的CPU时间，对比两次采样数据，计算出每个线程的增量CPU时间</li><li>线程CPU使用率 = 线程增量CPU时间 / 采样间隔时间 * 100%</li></ul><blockquote><p>注意： 这个统计也会产生一定的开销（JDK这个接口本身开销比较大），因此会看到as的线程占用一定的百分比，为了降低统计自身的开销带来的影响，可以把采样间隔拉长一些，比如5000毫秒。</p><p>另外一种查看Java进程的线程cpu使用率方法：可以使用<a target="_blank" rel="noopener" href="https://github.com/oldratlee/useful-scripts/blob/master/docs/java.md#-show-busy-java-threads">show-busy-java-threads</a>这个脚本</p></blockquote><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>如： 显示当前最忙的前3个线程并打印堆栈信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread -n 3</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626514227687.png" width="1626514227687"><ul><li>没有线程ID，包含<code>[Internal]</code>表示为JVM内部线程，参考<code>dashboard</code>命令的介绍。</li><li><code>cpuUsage</code>为采样间隔时间内线程的CPU使用率，与<code>dashboard</code>命令的数据一致。</li><li><code>deltaTime</code>为采样间隔时间内线程的增量CPU时间，小于1ms时被取整显示为0ms。</li><li><code>time</code> 线程运行总CPU时间。</li></ul><h3 id="当没有参数时，显示第一页线程信息"><a href="#当没有参数时，显示第一页线程信息" class="headerlink" title="当没有参数时，显示第一页线程信息"></a>当没有参数时，显示第一页线程信息</h3><p>默认按照CPU增量时间降序排列，只显示第一页数据，避免滚屏。</p><h3 id="thread-–all-显示所有匹配的线程"><a href="#thread-–all-显示所有匹配的线程" class="headerlink" title="thread –all, 显示所有匹配的线程"></a>thread –all, 显示所有匹配的线程</h3><p>显示所有匹配线程信息，有时需要获取全部JVM的线程数据进行分析。</p><h3 id="thread-id，-显示指定线程的运行堆栈"><a href="#thread-id，-显示指定线程的运行堆栈" class="headerlink" title="thread id， 显示指定线程的运行堆栈"></a>thread id， 显示指定线程的运行堆栈</h3><p>查看线程ID 1的栈：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread 1</span><br></pre></td></tr></table></figure><h3 id="thread-i-指定采样时间间隔"><a href="#thread-i-指定采样时间间隔" class="headerlink" title="thread -i, 指定采样时间间隔"></a>thread -i, 指定采样时间间隔</h3><ul><li><p><code>thread -i 1000</code> : 统计最近1000ms内的线程CPU时间。</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626514828921.png" width="1626514828921"></li><li><p><code>thread -n 3 -i 1000</code> : 列出1000ms内最忙的3个线程栈</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626514851368.png" width="1626514851368"></li></ul><h3 id="thread-–state-，查看指定状态的线程"><a href="#thread-–state-，查看指定状态的线程" class="headerlink" title="thread –state ，查看指定状态的线程"></a>thread –state ，查看指定状态的线程</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread --state WAITING </span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626514992047.png" width="1626514992047"><h3 id="thread-b-找出当前阻塞其他线程的线程"><a href="#thread-b-找出当前阻塞其他线程的线程" class="headerlink" title="thread -b, 找出当前阻塞其他线程的线程"></a>thread -b, 找出当前阻塞其他线程的线程</h3><p>有时候我们发现应用卡住了， 通常是由于某个线程拿住了某个锁， 并且其他线程都在等待这把锁造成的。 为了排查这类问题， arthas提供了<code>thread -b</code>， 一键找出那个罪魁祸首。</p><blockquote><p><strong>注意， 目前只支持找出synchronized关键字阻塞住的线程， 如果是<code>java.util.concurrent.Lock</code>， 目前还不支持。</strong></p></blockquote><p>写一个死锁程序：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hongliang;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Hongliang Zhu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-07-17 17:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        DinnerLockThread thread = <span class="keyword">new</span> DinnerLockThread();</span><br><span class="line">        <span class="keyword">new</span> Thread(thread, <span class="string">&quot;Jack&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(thread, <span class="string">&quot;Rose&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DinnerLockThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    String lock1 = <span class="string">&quot;第一根筷子&quot;</span>;</span><br><span class="line">    String lock2 = <span class="string">&quot;第二根筷子&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;Jack&quot;</span>.equals(Thread.currentThread().getName()))&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock1)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Jack 拿到了&quot;</span>+lock1);</span><br><span class="line">                <span class="keyword">synchronized</span> (lock2)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Jack 拿到了&quot;</span>+lock2);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock2)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Rose 拿到了&quot;</span>+lock2);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">synchronized</span> (lock1)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Rose 拿到了&quot;</span>+lock1);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@castile arthas]# java -cp demo-arthas-deadlock-1.0-SNAPSHOT.jar com.hongliang.Main</span><br><span class="line">Jack 拿到了第一根筷子</span><br><span class="line">Rose 拿到了第二根筷子</span><br><span class="line">... 出现死锁了...</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626516068279.png" width="1626516068279"><p>可以看到上面的Jack和Rose的线程已经Blocked</p><p>接下来使用arthas来诊断具体那个线程造成的死锁：</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626516191083.png" width="1626516191083"><h2 id="3-jvm-查看当前JVM信息"><a href="#3-jvm-查看当前JVM信息" class="headerlink" title="3.  jvm 查看当前JVM信息"></a>3. jvm 查看当前JVM信息</h2><p>查看当前JVM信息</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"> RUNTIME</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MACHINE-NAME                                               31604@castile.com</span><br><span class="line"> JVM-START-TIME                                             2021-07-17 17:59:24</span><br><span class="line"> MANAGEMENT-SPEC-VERSION                                    1.2</span><br><span class="line"> SPEC-NAME                                                  Java Virtual Machine Specification</span><br><span class="line"> SPEC-VENDOR                                                Oracle Corporation</span><br><span class="line"> SPEC-VERSION                                               1.8</span><br><span class="line"> VM-NAME                                                    Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line"> VM-VENDOR                                                  Oracle Corporation</span><br><span class="line"> VM-VERSION                                                 25.251-b08</span><br><span class="line"> INPUT-ARGUMENTS                                            []</span><br><span class="line"> CLASS-PATH                                                 demo-arthas-deadlock-1.0-SNAPSHOT.jar</span><br><span class="line"> BOOT-CLASS-PATH                                            /usr/jdk/jdk1.8.0_251/jre/lib/resources.jar:/usr/jdk/jdk1.8.0_251/jre/lib/rt.jar:/usr/jdk/jdk1.8.0_251/jre/lib/sunrsasign.jar:/usr/jdk/jdk1.8.0_251</span><br><span class="line">                                                            /jre/lib/jsse.jar:/usr/jdk/jdk1.8.0_251/jre/lib/jce.jar:/usr/jdk/jdk1.8.0_251/jre/lib/charsets.jar:/usr/jdk/jdk1.8.0_251/jre/lib/jfr.jar:/usr/jdk/j</span><br><span class="line">                                                            dk1.8.0_251/jre/classes</span><br><span class="line"> LIBRARY-PATH                                               /usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> CLASS-LOADING</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> LOADED-CLASS-COUNT                                         3457</span><br><span class="line"> TOTAL-LOADED-CLASS-COUNT                                   3457</span><br><span class="line"> UNLOADED-CLASS-COUNT                                       0</span><br><span class="line"> IS-VERBOSE                                                 false</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> COMPILATION</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> NAME                                                       HotSpot 64-Bit Tiered Compilers</span><br><span class="line"> TOTAL-COMPILE-TIME                                         804</span><br><span class="line"> [time (ms)]</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> GARBAGE-COLLECTORS</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> PS Scavenge                                                name : PS Scavenge</span><br><span class="line"> [count/time (ms)]                                          collectionCount : 6</span><br><span class="line">                                                            collectionTime : 31</span><br><span class="line"></span><br><span class="line"> PS MarkSweep                                               name : PS MarkSweep</span><br><span class="line"> [count/time (ms)]                                          collectionCount : 1</span><br><span class="line">                                                            collectionTime : 31</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MEMORY-MANAGERS</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> CodeCacheManager                                           Code Cache</span><br><span class="line"></span><br><span class="line"> Metaspace Manager                                          Metaspace</span><br><span class="line">                                                            Compressed Class Space</span><br><span class="line"></span><br><span class="line"> PS Scavenge                                                PS Eden Space</span><br><span class="line">                                                            PS Survivor Space</span><br><span class="line"></span><br><span class="line"> PS MarkSweep                                               PS Eden Space</span><br><span class="line">                                                            PS Survivor Space</span><br><span class="line">                                                            PS Old Gen</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MEMORY <span class="comment"># 内存相关</span></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> HEAP-MEMORY-USAGE                                          init : 31457280(30.0 MiB)</span><br><span class="line"> [memory in bytes]                                          used : 23836240(22.7 MiB)</span><br><span class="line">                                                            committed : 66060288(63.0 MiB)</span><br><span class="line">                                                            max : 425197568(405.5 MiB)</span><br><span class="line"></span><br><span class="line"> NO-HEAP-MEMORY-USAGE                                       init : 2555904(2.4 MiB)</span><br><span class="line"> [memory in bytes]                                          used : 27348920(26.1 MiB)</span><br><span class="line">                                                            committed : 28573696(27.3 MiB)</span><br><span class="line">                                                            max : -1(-1 B)</span><br><span class="line"></span><br><span class="line"> PENDING-FINALIZE-COUNT                                     0</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> OPERATING-SYSTEM<span class="comment">#系统相关</span></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> OS                                                         Linux</span><br><span class="line"> ARCH                                                       amd64</span><br><span class="line"> PROCESSORS-COUNT                                           4</span><br><span class="line"> LOAD-AVERAGE                                               0.0</span><br><span class="line"> VERSION                                                    3.10.0-1127.el7.x86_64</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> THREAD</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> COUNT                                                      16</span><br><span class="line"> DAEMON-COUNT                                               13</span><br><span class="line"> PEAK-COUNT                                                 17</span><br><span class="line"> STARTED-COUNT                                              20</span><br><span class="line"> DEADLOCK-COUNT                                             2</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> FILE-DESCRIPTOR <span class="comment"># 文件描述符</span></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MAX-FILE-DESCRIPTOR-COUNT                                  4096</span><br><span class="line"> OPEN-FILE-DESCRIPTOR-COUNT                                 103</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="THREAD相关"><a href="#THREAD相关" class="headerlink" title="THREAD相关"></a>THREAD相关</h3><ul><li>COUNT: JVM当前活跃的线程数</li><li>DAEMON-COUNT: JVM当前活跃的守护线程数</li><li>PEAK-COUNT: 从JVM启动开始曾经活着的最大线程数</li><li>STARTED-COUNT: 从JVM启动开始总共启动过的线程次数</li><li>DEADLOCK-COUNT: JVM当前死锁的线程数</li></ul><h3 id="文件描述符相关"><a href="#文件描述符相关" class="headerlink" title="文件描述符相关"></a>文件描述符相关</h3><ul><li>MAX-FILE-DESCRIPTOR-COUNT：JVM进程最大可以打开的文件描述符数</li><li>OPEN-FILE-DESCRIPTOR-COUNT：JVM当前打开的文件描述符数</li></ul><h2 id="4-sysprop-系统属性相关"><a href="#4-sysprop-系统属性相关" class="headerlink" title="4. sysprop 系统属性相关"></a>4. sysprop 系统属性相关</h2><h3 id="查看单个属性"><a href="#查看单个属性" class="headerlink" title="查看单个属性"></a>查看单个属性</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sysprop java.version</span></span><br><span class="line">java.version=1.8.0_51</span><br></pre></td></tr></table></figure><h3 id="修改单个属性"><a href="#修改单个属性" class="headerlink" title="修改单个属性"></a>修改单个属性</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sysprop user.country</span></span><br><span class="line">user.country=US</span><br><span class="line"><span class="meta">$</span><span class="bash"> sysprop user.country CN</span></span><br><span class="line">Successfully changed the system property.</span><br><span class="line">user.country=CN</span><br></pre></td></tr></table></figure><h2 id="5-sysenv-查看jvm环境信息"><a href="#5-sysenv-查看jvm环境信息" class="headerlink" title="5. sysenv 查看jvm环境信息"></a>5. sysenv 查看jvm环境信息</h2><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626517078834.png" width="1626517078834"><p>也可以只看其中一个环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@31604]$</span><span class="bash"> sysenv JAVA_HOME</span></span><br><span class="line"> KEY                                       VALUE</span><br><span class="line"> JAVA_HOME                                 /usr/jdk/jdk1.8.0_251</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@31604]$</span><span class="bash"> sysenv CLASSPATH</span></span><br><span class="line"> KEY                                       VALUE</span><br><span class="line"> CLASSPATH                               .:/usr/jdk/jdk1.8.0_251/lib.tools.jar</span><br></pre></td></tr></table></figure><h2 id="6-vmoption查看，更新VM诊断相关的参数"><a href="#6-vmoption查看，更新VM诊断相关的参数" class="headerlink" title="6. vmoption查看，更新VM诊断相关的参数"></a>6. vmoption查看，更新VM诊断相关的参数</h2><p>查看，更新VM诊断相关的参数</p><ul><li><p>vmoption : 查看所有的option</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626517607909.png" width="1626517607909"></li><li><p>vmoption PrintGCDetails : 查看指定的option</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">arthas@31604]$</span><span class="bash"> vmoption PrintGCDetails</span></span><br><span class="line"> KEY              VALUE                ORIGIN             WRITEABLE</span><br><span class="line"> PrintGCDetails   false                DEFAULT              true</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>vmoption PrintGCDetails true ： 更新指定的option</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626529130220.png" width="1626529130220"></li></ul><h2 id="7-getstatic查看类的静态属性"><a href="#7-getstatic查看类的静态属性" class="headerlink" title="7. getstatic查看类的静态属性"></a>7. getstatic查看类的静态属性</h2><p>通过getstatic命令可以方便的查看类的静态属性。使用方法为<code>getstatic class_name field_name</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@34093]$</span><span class="bash"> getstatic demo.MathGame random <span class="comment"># 查看MathGame里面的random字段</span></span></span><br><span class="line">field: random # 字段</span><br><span class="line">@Random[</span><br><span class="line">    serialVersionUID=@Long[3905348978240129619],</span><br><span class="line">    seed=@AtomicLong[144884610029513],</span><br><span class="line">    multiplier=@Long[25214903917],</span><br><span class="line">    addend=@Long[11],</span><br><span class="line">    mask=@Long[281474976710655],</span><br><span class="line">    DOUBLE_UNIT=@Double[1.1102230246251565E-16],</span><br><span class="line">    BadBound=@String[bound must be positive],</span><br><span class="line">    BadRange=@String[bound must be greater than origin],</span><br><span class="line">    BadSize=@String[size must be non-negative],</span><br><span class="line">    seedUniquifier=@AtomicLong[3620162808252824828],</span><br><span class="line">    nextNextGaussian=@Double[0.0],</span><br><span class="line">    haveNextNextGaussian=@Boolean[false],</span><br><span class="line">    serialPersistentFields=@ObjectStreamField[][isEmpty=false;size=3],</span><br><span class="line">    unsafe=@Unsafe[sun.misc.Unsafe@2b0f66cd],</span><br><span class="line">    seedOffset=@Long[24],</span><br><span class="line">]</span><br><span class="line">Affect(row-cnt:1) cost in 10 ms.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>推荐直接使用<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/ognl.html">ognl</a>命令，更加灵活 。</p><table><thead><tr><th><em>express</em></th><th>执行的表达式</th></tr></thead><tbody><tr><td><code>[c:]</code></td><td>执行表达式的 ClassLoader 的 hashcode，默认值是SystemClassLoader</td></tr><tr><td><code>[classLoaderClass:]</code></td><td>指定执行表达式的 ClassLoader 的 class name</td></tr><tr><td>[x]</td><td>结果对象的展开层次，默认值1</td></tr></tbody></table><p>调用静态函数：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ognl <span class="string">&#x27;@java.lang.System@out.println(&quot;hello&quot;)&#x27;</span></span></span><br><span class="line">返回null</span><br></pre></td></tr></table></figure><p>获取静态类的静态字段：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ognl <span class="string">&#x27;@demo.MathGame@random&#x27;</span></span></span><br><span class="line">@Random[</span><br><span class="line">    serialVersionUID=@Long[3905348978240129619],</span><br><span class="line">    seed=@AtomicLong[125451474443703],</span><br><span class="line">    multiplier=@Long[25214903917],</span><br><span class="line">    addend=@Long[11],</span><br><span class="line">    mask=@Long[281474976710655],</span><br><span class="line">    DOUBLE_UNIT=@Double[1.1102230246251565E-16],</span><br><span class="line">    BadBound=@String[bound must be positive],</span><br><span class="line">    BadRange=@String[bound must be greater than origin],</span><br><span class="line">    BadSize=@String[size must be non-negative],</span><br><span class="line">    seedUniquifier=@AtomicLong[-3282039941672302964],</span><br><span class="line">    nextNextGaussian=@Double[0.0],</span><br><span class="line">    haveNextNextGaussian=@Boolean[false],</span><br><span class="line">    serialPersistentFields=@ObjectStreamField[][isEmpty=false;size=3],</span><br><span class="line">    unsafe=@Unsafe[sun.misc.Unsafe@28ea5898],</span><br><span class="line">    seedOffset=@Long[24],</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>执行多行表达式，赋值给临时变量，返回一个List：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> ognl &#x27;#value1=@System@getProperty(&quot;java.home&quot;), #value2=@System@getProperty(&quot;java.runtime.name&quot;), &#123;#value1, #value2&#125;&#x27;</span><br><span class="line"> </span><br><span class="line"> @ArrayList[</span><br><span class="line">    @String[/opt/java/8.0.181-zulu/jre],</span><br><span class="line">    @String[OpenJDK Runtime Environment],</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li>OGNL特殊用法请参考：<a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/71">https://github.com/alibaba/arthas/issues/71</a></li><li>OGNL表达式官方指南：<a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-ognl/language-guide.html">https://commons.apache.org/proper/commons-ognl/language-guide.html</a></li></ul><h1 id="八、Class-ClassLoader相关命令"><a href="#八、Class-ClassLoader相关命令" class="headerlink" title="八、Class/ClassLoader相关命令"></a>八、Class/ClassLoader相关命令</h1><h2 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h2><ol><li>sc： Search-Class 。查看JVM已加载的类信息</li><li>sm： Search-Method 。 查看已加载类的方法信息</li><li>jad: 把字节码反编译成源代码</li></ol><h2 id="1-sc查看JVM已加载的类信息"><a href="#1-sc查看JVM已加载的类信息" class="headerlink" title="1. sc查看JVM已加载的类信息"></a>1. sc查看JVM已加载的类信息</h2><p>Search-Class” 的简写，这个命令能搜索出所有已经加载到 JVM 中的 Class 信息，这个命令支持的参数有 <code>[d]</code>、<code>[E]</code>、<code>[f]</code> 和 <code>[x:]</code>。</p><table><thead><tr><th>参数名称</th><th>参数说明</th></tr></thead><tbody><tr><td><em>class-pattern</em></td><td>类名表达式匹配</td></tr><tr><td><em>method-pattern</em></td><td>方法名表达式匹配</td></tr><tr><td>[d]</td><td>输出当前类的详细信息，包括这个类所加载的原始文件来源、类的声明、加载的ClassLoader等详细信息。 如果一个类被多个ClassLoader所加载，则会出现多次</td></tr><tr><td>[E]</td><td>开启正则表达式匹配，默认为通配符匹配</td></tr><tr><td>[f]</td><td>输出当前类的成员变量信息（需要配合参数-d一起使用）</td></tr><tr><td>[x:]</td><td>指定输出静态变量时属性的遍历深度，默认为 0，即直接使用 <code>toString</code> 输出</td></tr><tr><td><code>[c:]</code></td><td>指定class的 ClassLoader 的 hashcode</td></tr><tr><td><code>[classLoaderClass:]</code></td><td>指定执行表达式的 ClassLoader 的 class name</td></tr><tr><td><code>[n:]</code></td><td>具有详细信息的匹配类的最大数量（默认为100）</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc com.hongliang.DinnerLockThread -d</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626531356962.png" width="1626531356962"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc com.hongliang.DinnerLockThread -df</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626531485542.png" width="1626531485542"><p>sc 默认开启了子类匹配功能，也就是说所有当前类的子类也会被搜索出来，想要精确的匹配，请打开<code>options disable-sub-class true</code>开关</p><h2 id="2-sm查看已加载类的方法信息"><a href="#2-sm查看已加载类的方法信息" class="headerlink" title="2. sm查看已加载类的方法信息"></a>2. sm查看已加载类的方法信息</h2><p>“Search-Method” 的简写，这个命令能搜索出所有已经加载了 Class 信息的<strong>方法信息</strong>。</p><p><code>sm</code> 命令只能看到由当前类所声明 (declaring) 的方法，父类则无法看到。</p><table><thead><tr><th>参数名称</th><th>参数说明</th></tr></thead><tbody><tr><td><em>class-pattern</em></td><td>类名表达式匹配</td></tr><tr><td><em>method-pattern</em></td><td>方法名表达式匹配</td></tr><tr><td>[d]</td><td>展示每个方法的详细信息</td></tr><tr><td>[E]</td><td>开启正则表达式匹配，默认为通配符匹配</td></tr><tr><td><code>[c:]</code></td><td>指定class的 ClassLoader 的 hashcode</td></tr><tr><td><code>[classLoaderClass:]</code></td><td>指定执行表达式的 ClassLoader 的 class name</td></tr><tr><td><code>[n:]</code></td><td>具有详细信息的匹配类的最大数量（默认为100）</td></tr></tbody></table><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626531726921.png" width="1626531726921"><h2 id="3-jad-把字节码反编译成源代码"><a href="#3-jad-把字节码反编译成源代码" class="headerlink" title="3.  jad: 把字节码反编译成源代码"></a>3. jad: 把字节码反编译成源代码</h2><p><code>jad</code> 命令将 JVM 中实际运行的 class 的 byte code 反编译成 java 代码，便于你理解业务逻辑；</p><ul><li>在 Arthas Console 上，反编译出来的源码是带<strong>语法高亮</strong>的，阅读更方便</li><li>当然，反编译出来的 java 代码可能会存在语法错误，但不影响你进行阅读理解</li></ul><table><thead><tr><th>参数名称</th><th>参数说明</th></tr></thead><tbody><tr><td><em>class-pattern</em></td><td>类名表达式匹配</td></tr><tr><td><code>[c:]</code></td><td>类所属 ClassLoader 的 hashcode</td></tr><tr><td><code>[classLoaderClass:]</code></td><td>指定执行表达式的 ClassLoader 的 class name</td></tr><tr><td>[E]</td><td>开启正则表达式匹配，默认为通配符匹配</td></tr></tbody></table><h3 id="反编译java-lang-String"><a href="#反编译java-lang-String" class="headerlink" title="反编译java.lang.String"></a>反编译<code>java.lang.String</code></h3><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626533128923.png" width="1626533128923"><h3 id="反编译时只显示源代码"><a href="#反编译时只显示源代码" class="headerlink" title="反编译时只显示源代码"></a>反编译时只显示源代码</h3><p>默认情况下，反编译结果里会带有<code>ClassLoader</code>信息，通过<code>--source-only</code>选项，可以只打印源代码。方便和<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/mc.html">mc</a>/<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/retransform.html">retransform</a>命令结合使用。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jad --source-only demo.MathGame </span><br></pre></td></tr></table></figure><h3 id="反编译时指定ClassLoader"><a href="#反编译时指定ClassLoader" class="headerlink" title="反编译时指定ClassLoader"></a>反编译时指定ClassLoader</h3><p>当有多个 <code>ClassLoader</code> 都加载了这个类时，<code>jad</code> 命令会输出对应 <code>ClassLoader</code> 实例的 <code>hashcode</code>，然后你只需要重新执行 <code>jad</code> 命令，并使用参数 <code>-c</code> 就可以反编译指定 ClassLoader 加载的那个类了；</p><h3 id="反编译指定的函数"><a href="#反编译指定的函数" class="headerlink" title="反编译指定的函数"></a>反编译指定的函数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jad demo.MathGame main</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626533435556.png" width="1626533435556"><h2 id="4-mc内存编译"><a href="#4-mc内存编译" class="headerlink" title="4. mc内存编译"></a>4. mc内存编译</h2><p>Memory Compiler/内存编译器，编译<code>.java</code>文件生成<code>.class</code>。</p><p>可以通过<code>-d</code>命令指定输出目录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc -d /tmp/output /tmp/ClassA.java /tmp/ClassB.java</span><br></pre></td></tr></table></figure><p>编译生成<code>.class</code>文件之后，可以结合<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/retransform.html">retransform</a>命令实现热更新代码。</p><p>注意，mc命令有可能失败。如果编译失败可以在本地编译好<code>.class</code>文件，再上传到服务器。具体参考<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/retransform.html">retransform</a>命令说明。</p><p>可以通过<code>-c</code>参数指定classloader：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc -c 327a647b /tmp/Test.java</span><br></pre></td></tr></table></figure><h2 id="5-redefine"><a href="#5-redefine" class="headerlink" title="5. redefine"></a>5. redefine</h2><p>加载外部的<code>.class</code>文件，redefine jvm已加载的类。</p><h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><ul><li>redefine的class不能<strong>修改、添加、删除</strong>类的<strong>field</strong>和<strong>method</strong>，包括<strong>方法参数</strong>、<strong>方法名称</strong>及<strong>返回值</strong></li><li>如果<code>mc</code>失败，可以在本地开发环境编译好class文件，上传到目标系统，使用<code>redefine</code>热加载class</li><li>目前<code>redefine</code> 和watch/trace/jad/tt等命令冲突，以后重新实现redefine功能会解决此问题</li></ul><blockquote><p>注意， redefine后的原来的类不能恢复，redefine有可能失败（比如增加了新的field），参考jdk本身的文档。</p><p><code>reset</code>命令对<code>redefine</code>的类无效。如果想重置，需要<code>redefine</code>原始的字节码。</p><p><code>redefine</code>命令和<code>jad</code>/<code>watch</code>/<code>trace</code>/<code>monitor</code>/<code>tt</code>等命令会冲突。执行完<code>redefine</code>之后，如果再执行上面提到的命令，则会把<code>redefine</code>的字节码重置。 原因是jdk本身redefine和Retransform是不同的机制，同时使用两种机制来更新字节码，只有最后修改的会生效。</p></blockquote><h3 id="redefine的限制"><a href="#redefine的限制" class="headerlink" title="redefine的限制"></a>redefine的限制</h3><ul><li>不允许新增加field/method</li><li>正在跑的函数，没有退出不能生效。</li></ul><h3 id="举例热更新代码"><a href="#举例热更新代码" class="headerlink" title="举例热更新代码"></a>举例热更新代码</h3><h4 id="源码准备"><a href="#源码准备" class="headerlink" title="源码准备"></a>源码准备</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hongliang;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Hongliang Zhu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2021-07-17 23:36</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintNum</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">        PrintNum p = <span class="keyword">new</span> PrintNum();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1L</span>);</span><br><span class="line"><span class="comment">//             System.out.println(&quot;我是在main中新增的代码&quot;);</span></span><br><span class="line">            p.run(i);</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">int</span> i)</span>   </span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println(&quot;在run中新增的代码&quot;);</span></span><br><span class="line">        System.out.println(<span class="string">&quot;run--&gt;&quot;</span>+i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其中注释的是要即将修改的代码！！！</p><h4 id="jad反编译"><a href="#jad反编译" class="headerlink" title="jad反编译"></a>jad反编译</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jad --source-only com.hongliang.PrintNum &gt; /tmp/PrintNum.java</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626537037313.png" width="1626537037313"><h4 id="sc查找加载PrintNum的ClassLoader"><a href="#sc查找加载PrintNum的ClassLoader" class="headerlink" title="sc查找加载PrintNum的ClassLoader"></a>sc查找加载PrintNum的ClassLoader</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@35673]$</span><span class="bash"> sc -d com.hongliang.PrintNum | grep classLoaderHash</span></span><br><span class="line"> classLoaderHash   7852e922</span><br></pre></td></tr></table></figure><h4 id="mc编译"><a href="#mc编译" class="headerlink" title="mc编译"></a>mc编译</h4><p>保存好<code>/tmp/PrintNum.java</code>之后，使用<code>mc</code>(Memory Compiler)命令来编译，并且通过<code>-c</code>参数指定ClassLoader的hash</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@35673]$</span><span class="bash"> mc -c 7852e922 /tmp/PrintNum.java -d /tmp/</span></span><br><span class="line">Memory compiler output:</span><br><span class="line">/tmp/com/hongliang/PrintNum.class</span><br><span class="line">Affect(row-cnt:1) cost in 831 ms.</span><br></pre></td></tr></table></figure><h4 id="redefine"><a href="#redefine" class="headerlink" title="redefine"></a>redefine</h4><p>再使用<code>redefine</code>命令重新加载新编译好的<code>PrintNum.class</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@35673]$</span><span class="bash"> redefine /tmp/com/hongliang/PrintNum.class</span></span><br><span class="line">redefine success, size: 1, classes:</span><br><span class="line">com.hongliang.PrintNum</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626537314248.png" width="1626537314248"><h4 id="注：使用jad等命令导致重置"><a href="#注：使用jad等命令导致重置" class="headerlink" title="注：使用jad等命令导致重置"></a>注：使用jad等命令导致重置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jad com.hongliang.PrintNum</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626537438540.png" width="1626537438540"> <img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626537404225.png" width="1626537404225"><h2 id="6-dump"><a href="#6-dump" class="headerlink" title="6. dump"></a>6. dump</h2><p>将已经加载类的字节码文件保存到特定目录： logs/arthas/classdump/</p><table><thead><tr><th>参数名称</th><th>参数说明</th></tr></thead><tbody><tr><td><em>class-pattern</em></td><td>类名表达式匹配</td></tr><tr><td><code>[c:]</code></td><td>类所属 ClassLoader 的 hashcode</td></tr><tr><td><code>[classLoaderClass:]</code></td><td>指定执行表达式的 ClassLoader 的 class name</td></tr><tr><td><code>[d:]</code></td><td>设置类文件的目标目录</td></tr><tr><td>[E]</td><td>开启正则表达式匹配，默认为通配符匹配</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dump -d /tmp/output java.lang.String # String类的字节码文件放到指定目录中</span><br><span class="line">dump demo.* # </span><br><span class="line">HASHCODE  CLASSLOADER                                    LOCATION</span><br><span class="line"> 3d4eac69  +-sun.misc.Launcher$AppClassLoader@3d4eac69    /Users/admin/logs/arthas/classdump/sun.misc.Launcher$AppClassLoader-3d4eac69/demo/MathGame.class</span><br><span class="line">             +-sun.misc.Launcher$ExtClassLoader@66350f69</span><br><span class="line">Affect(row-cnt:1) cost in 39 ms.</span><br></pre></td></tr></table></figure><h2 id="7-classloader"><a href="#7-classloader" class="headerlink" title="7. classloader"></a>7. classloader</h2><p>查看classloader的继承树，urls，类加载信息</p><p><code>classloader</code> 命令将 JVM 中所有的classloader的信息统计出来，并可以展示<strong>继承树</strong>，urls等。</p><p>可以让指定的classloader去getResources，打印出所有查找到的resources的url。对于<code>ResourceNotFoundException</code>比较有用。</p><table><thead><tr><th align="center">参数名称</th><th align="center">参数说明</th></tr></thead><tbody><tr><td align="center">[l]</td><td align="center">按类加载实例进行统计</td></tr><tr><td align="center">[t]</td><td align="center">打印所有ClassLoader的继承树</td></tr><tr><td align="center">[a]</td><td align="center">列出所有ClassLoader加载的类，请谨慎使用</td></tr><tr><td align="center"><code>[c:]</code></td><td align="center">ClassLoader的hashcode</td></tr><tr><td align="center"><code>[classLoaderClass:]</code></td><td align="center">指定执行表达式的 ClassLoader 的 class name</td></tr><tr><td align="center"><code>[c: r:]</code></td><td align="center">用ClassLoader去查找resource</td></tr><tr><td align="center"><code>[c: load:]</code></td><td align="center">用ClassLoader去加载指定的类</td></tr></tbody></table><ol><li><p>显示所有类加载器的信息</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626576723307.png" width="1626576723307"></li><li><p>获取某个类加载器所在的jar包</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626576966746.png" width="1626576966746"></li><li><p>获取某个资源在哪个jar包中</p></li><li><p>加载某个类</p></li></ol><h1 id="九、增强命令"><a href="#九、增强命令" class="headerlink" title="九、增强命令"></a>九、增强命令</h1><h2 id="目标-2"><a href="#目标-2" class="headerlink" title="目标"></a>目标</h2><ol><li>monitor 方法执行监控</li><li>watch方法执行数据观测</li><li>trace 输出当前方法的调用路径</li><li>tt 方法执行数据的时空隧道</li><li>profiler 火焰图</li></ol><h2 id="1-monitor方法执行监控"><a href="#1-monitor方法执行监控" class="headerlink" title="1. monitor方法执行监控"></a>1. monitor方法执行监控</h2><p>对匹配 <code>class-pattern</code>／<code>method-pattern</code>的类、方法的调用进行监控。</p><p><code>monitor</code> 命令是一个<strong>非实时</strong>返回命令.</p><blockquote><p>实时返回命令是输入之后立即返回，而非实时返回的命令，则是不断的等待目标 Java 进程返回信息，直到用户输入 <code>Ctrl+C</code> 为止。</p></blockquote><p>服务端是以任务的形式在后台跑任务，植入的代码随着任务的中止而不会被执行，所以任务关闭后，不会对原有性能产生太大影响，而且原则上，任何Arthas命令不会引起原有业务逻辑的改变。</p><h3 id="监控的维度说明"><a href="#监控的维度说明" class="headerlink" title="监控的维度说明"></a>监控的维度说明</h3><table><thead><tr><th align="center">监控项</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">timestamp</td><td align="center">时间戳</td></tr><tr><td align="center">class</td><td align="center">Java类</td></tr><tr><td align="center">method</td><td align="center">方法（构造方法、普通方法）</td></tr><tr><td align="center">total</td><td align="center">调用次数</td></tr><tr><td align="center">success</td><td align="center">成功次数</td></tr><tr><td align="center">fail</td><td align="center">失败次数</td></tr><tr><td align="center">rt</td><td align="center">平均RT(平均耗时)</td></tr><tr><td align="center">fail-rate</td><td align="center">失败率</td></tr></tbody></table><p>方法拥有一个命名参数 <code>[c:]</code>，意思是统计周期（cycle of output），拥有一个整型的参数值</p><table><thead><tr><th align="right">参数名称</th><th align="left">参数说明</th></tr></thead><tbody><tr><td align="right"><em>class-pattern</em></td><td align="left">类名表达式匹配</td></tr><tr><td align="right"><em>method-pattern</em></td><td align="left">方法名表达式匹配</td></tr><tr><td align="right">[E]</td><td align="left">开启正则表达式匹配，默认为通配符匹配</td></tr><tr><td align="right"><code>[c:]</code></td><td align="left">统计周期，默认值为<strong>120</strong>秒</td></tr></tbody></table><p>每5s监控一次，类demo.MathGame中的primeFactors方法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">monitor -c 5 demo.MathGame primeFactors</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626577463368.png" width="1626577463368"><h2 id="2-watch-方法执行数据观测"><a href="#2-watch-方法执行数据观测" class="headerlink" title="2. watch 方法执行数据观测"></a>2. watch 方法执行数据观测</h2><p>让你能方便的观察到指定方法的调用情况。能观察到的范围为：<code>返回值</code>、<code>抛出异常</code>、<code>入参</code>，通过编写 OGNL 表达式进行对应变量的查看。</p><h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><p>watch 的参数比较多，主要是因为它能在 4 个不同的场景观察对象</p><table><thead><tr><th align="center">参数名称</th><th align="center">参数说明</th></tr></thead><tbody><tr><td align="center"><em>class-pattern</em></td><td align="center">类名表达式匹配</td></tr><tr><td align="center"><em>method-pattern</em></td><td align="center">方法名表达式匹配</td></tr><tr><td align="center"><em>express</em></td><td align="center">观察表达式</td></tr><tr><td align="center"><em>condition-express</em></td><td align="center">条件表达式</td></tr><tr><td align="center">[b]</td><td align="center">在<strong>方法调用之前</strong>观察</td></tr><tr><td align="center">[e]</td><td align="center">在<strong>方法异常之后</strong>观察</td></tr><tr><td align="center">[s]</td><td align="center">在<strong>方法返回之后</strong>观察</td></tr><tr><td align="center">[f]</td><td align="center">在<strong>方法结束之后</strong>(正常返回和异常返回)观察</td></tr><tr><td align="center">[E]</td><td align="center">开启正则表达式匹配，默认为通配符匹配</td></tr><tr><td align="center">[x:]</td><td align="center">指定输出结果的属性遍历深度，默认为 1</td></tr></tbody></table><p>这里重点要说明的是观察表达式，观察表达式的构成主要由 ognl 表达式组成，所以你可以这样写<code>&quot;&#123;params,returnObj&#125;&quot;</code>，只要是一个合法的 ognl 表达式，都能被正常支持。</p><p>观察的维度也比较多，主要体现在参数 <code>advice</code> 的数据结构上。<code>Advice</code> 参数最主要是封装了通知节点的所有信息。请参考<a target="_blank" rel="noopener" href="https://katacoda.com/embed/arthas/command-watch-cn/advice-class.md">表达式核心变量</a>中关于该节点的描述。</p><ul><li>特殊用法请参考：<a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/71">https://github.com/alibaba/arthas/issues/71</a></li><li>OGNL表达式官网：<a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-ognl/language-guide.html">https://commons.apache.org/proper/commons-ognl/language-guide.html</a></li></ul><p><strong>特别说明</strong>：</p><ul><li>watch 命令定义了4个观察事件点，即 <code>-b</code> 方法调用前，<code>-e</code> 方法异常后，<code>-s</code> 方法返回后，<code>-f</code> 方法结束后</li><li>4个观察事件点 <code>-b</code>、<code>-e</code>、<code>-s</code> 默认关闭，<code>-f</code> 默认打开，当指定观察点被打开后，在相应事件点会对观察表达式进行求值并输出</li><li>这里要注意<code>方法入参</code>和<code>方法出参</code>的区别，有可能在中间被修改导致前后不一致，除了 <code>-b</code> 事件点 <code>params</code> 代表方法入参外，其余事件都代表方法出参</li><li>当使用 <code>-b</code> 时，由于观察事件点是在方法调用前，此时返回值或异常均不存在</li></ul><h3 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h3><ol><li><p>观察demo.MathGame类中primeFactors方法<strong>出参和返回值</strong>，结果属性遍历深度为2</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &quot;&#123;params,returnObj&#125;&quot; -x 2</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626581994840.png" width="1626581994840"></li><li><p>观察方法的入参</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &quot;&#123;params,returnObj&#125;&quot; -x 2 -b</span><br></pre></td></tr></table></figure><p>对比前一个例子，返回值为空（事件点为方法执行前，因此获取不到返回值）</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626582118394.png" width="1626582118394"></li><li><p>观察当前对象中的属性，如果想查看方法运行前后当前对象中的属性，可以使用target关键字代表当前对象。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &quot;&#123;params,target,returnObj&#125;&quot; -x 2 -b -s -n 2</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626584425202.png" width="1626584425202"></li></ol><ul><li>参数里<code>-n 2</code>，表示只执行两次</li><li>这里输出结果中，第一次输出的是方法调用前的观察表达式的结果，第二次输出的是方法返回后的表达式的结果</li><li>结果的输出顺序和事件发生的先后顺序一致，和命令中 <code>-s -b</code> 的顺序无关</li></ul><ol start="4"><li><p>调整<code>-x</code>的值，观察具体的方法参数值</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &quot;&#123;params,target&#125;&quot; -x 3</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626584539103.png" width="1626584539103"></li></ol><ul><li><code>-x</code>表示遍历深度，可以调整来打印具体的参数和结果内容，默认值是1。</li></ul><ol start="5"><li><p>条件表达式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &quot;&#123;params[0],target&#125;&quot; &quot;params[0]&lt;0&quot;</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626584640497.png" width="1626584640497"></li></ol><ul><li>只有满足条件的调用，才会有响应。</li><li><code>watch-express</code> 单个值可以不加’{}’，多个值需要加’{a,b,c}’。</li><li><code>condition-express</code> 不能加’{}’，可以使用逗号分隔子表达式，取表达式最后一个值来判断。</li></ul><p>如果watch的方法存在<strong>同名</strong>的其它<strong>重载方法</strong>，可以通过下面的办法进行过滤：</p><p>根据参数类型进行过滤</p><p><code>watch demo.MathGame primeFactors &#39;&#123;params, params[0].class.name&#125;&#39; &#39;params[0].class.name == &quot;java.lang.Integer&quot;&#39;</code></p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626584764553.png" width="1626584764553"><p>根据参数个数进行过滤</p><p><code>watch demo.MathGame primeFactors &#39;&#123;params, params.length&#125;&#39; &#39;params.length==1&#39;</code></p><ol start="6"><li><p>观察异常信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &quot;&#123;params[0],throwExp&#125;&quot; -e -x 2 </span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626584867367.png" width="1626584867367"></li></ol><ul><li><p><code>-e</code>表示抛出异常时才触发</p></li><li><p>express中，表示异常信息的变量是<code>throwExp</code></p></li><li><p>根据异常类型或者message进行过滤：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &#x27;&#123;params, throwExp&#125;&#x27; &#x27;#msg=throwExp.toString(), #msg.contains(&quot;IllegalArgumentException&quot;)&#x27; -e -x 2</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626585063811.png" width="1626585063811"></li></ul><ol start="7"><li><p>观察当前对象中的属性</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &#x27;target&#x27;</span><br></pre></td></tr></table></figure><p>如果想查看方法运行前后，当前对象中的属性，可以使用<code>target</code>关键字，代表当前对象 .</p><p>然后使用<code>target.field_name</code>访问当前对象的某个属性 。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &#x27;target.illegalArgumentCount&#x27;</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626585179744.png" width="1626585179744"></li></ol><h2 id="3-trace-方法内部调用路径追踪"><a href="#3-trace-方法内部调用路径追踪" class="headerlink" title="3. trace 方法内部调用路径追踪"></a>3. trace 方法内部调用路径追踪</h2><p>方法内部调用路径，并输出方法路径上的每个节点上耗时。</p><p><code>trace</code> 命令能主动搜索 <code>class-pattern</code>／<code>method-pattern</code> 对应的方法调用路径，渲染和统计整个调用链路上的所有性能开销和追踪调用链路。</p><h3 id="参数说明-1"><a href="#参数说明-1" class="headerlink" title="参数说明"></a>参数说明</h3><table><thead><tr><th align="center">参数名称</th><th align="center">参数说明</th></tr></thead><tbody><tr><td align="center"><em>class-pattern</em></td><td align="center">类名表达式匹配</td></tr><tr><td align="center"><em>method-pattern</em></td><td align="center">方法名表达式匹配</td></tr><tr><td align="center"><em>condition-express</em></td><td align="center">条件表达式</td></tr><tr><td align="center">[E]</td><td align="center">开启正则表达式匹配，默认为通配符匹配</td></tr><tr><td align="center"><code>[n:]</code></td><td align="center">命令执行次数</td></tr><tr><td align="center"><code>#cost</code></td><td align="center">方法执行耗时</td></tr></tbody></table><p>观察的维度也比较多，主要体现在参数 <code>advice</code> 的数据结构上。<code>Advice</code> 参数最主要是封装了通知节点的所有信息。</p><p>很多时候我们只想看到某个方法的rt大于某个时间之后的trace结果，现在Arthas可以按照方法执行的耗时来进行过滤了，例如<code>trace *StringUtils isBlank &#39;#cost&gt;100&#39;</code>表示当执行时间超过100ms的时候，才会输出trace的结果。</p><blockquote><p>watch/stack/trace这个三个命令都支持<code>#cost</code></p></blockquote><p><code>trace</code> 能方便的帮助你定位和发现因 RT 高而导致的性能问题缺陷，但其每次只能跟踪一级方法的调用链路。</p><p>参考：<a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/597">Trace命令的实现原理</a></p><p>3.3.0 版本后，可以使用动态Trace功能，不断增加新的匹配类，参考下面的示例。</p><h3 id="举例-2"><a href="#举例-2" class="headerlink" title="举例"></a>举例</h3><ol><li><p>trace函数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trace demo.MathGame run</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626586964556.png" width="1626586964556"></li><li><p>trace次数限制</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trace demo.MathGame run -n 1</span><br></pre></td></tr></table></figure></li><li><p>包含jdk的函数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trace --skipJDKMethod false demo.MathGame run</span><br></pre></td></tr></table></figure><p>默认情况下，trace不会包含jdk里的函数调用，如果希望trace jdk里的函数，需要显式设置<code>--skipJDKMethod false</code>。</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626587115355.png" width="1626587115355"></li><li><p>根据调用耗时来过滤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trace demo.MathGame run &#x27;#cost &gt; 10&#x27;</span><br></pre></td></tr></table></figure><p>只会展示耗时大于10ms的调用路径，有助于在排查问题的时候，只关注异常情况</p></li></ol><h2 id="4-stack输出当前方法的调用路径"><a href="#4-stack输出当前方法的调用路径" class="headerlink" title="4. stack输出当前方法的调用路径"></a>4. stack输出当前方法的调用路径</h2><p>很多时候我们都知道一个方法被执行，但这个方法被执行的路径非常多，或者你根本就不知道这个方法是从那里被执行了，此时你需要的是 stack 命令。</p><h3 id="参数说明-2"><a href="#参数说明-2" class="headerlink" title="参数说明"></a>参数说明</h3><table><thead><tr><th align="center">参数名称</th><th align="center">参数说明</th></tr></thead><tbody><tr><td align="center"><em>class-pattern</em></td><td align="center">类名表达式匹配</td></tr><tr><td align="center"><em>method-pattern</em></td><td align="center">方法名表达式匹配</td></tr><tr><td align="center"><em>condition-express</em></td><td align="center">条件表达式</td></tr><tr><td align="center">[E]</td><td align="center">开启正则表达式匹配，默认为通配符匹配</td></tr><tr><td align="center"><code>[n:]</code></td><td align="center">执行次数限制</td></tr></tbody></table><h3 id="举例-3"><a href="#举例-3" class="headerlink" title="举例"></a>举例</h3><ol><li><p>展示primeFactors的调用路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stack demo.MathGame primeFactors</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626588168229.png" width="1626588168229"></li><li><p>参数小于0的，执行两次</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stack demo.MathGame primeFactors &#x27;params[0]&lt;0&#x27; -n 2</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626588540360.png" width="1626588540360"></li><li><p>根据执行时间过滤。大于0.5ms的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stack demo.MathGame primeFactors &#x27;#cost&gt;0.5&#x27;</span><br></pre></td></tr></table></figure></li></ol><h2 id="5-tt-方法执行数据的时空隧道"><a href="#5-tt-方法执行数据的时空隧道" class="headerlink" title="5. tt 方法执行数据的时空隧道"></a>5. tt 方法执行数据的时空隧道</h2><blockquote><p>方法执行数据的时空隧道，记录下指定方法每次调用的入参和返回信息，并能对这些不同的时间下调用进行观测</p></blockquote><p><code>watch</code> 虽然很方便和灵活，但需要提前想清楚观察表达式的拼写，这对排查问题而言要求太高，因为很多时候我们并不清楚问题出自于何方，只能靠蛛丝马迹进行猜测。</p><p>这个时候如果能记录下当时方法调用的所有入参和返回值、抛出的异常会对整个问题的思考与判断非常有帮助。</p><p>于是乎，TimeTunnel 命令就诞生了。</p><h3 id="举例-4"><a href="#举例-4" class="headerlink" title="举例"></a>举例</h3><ol><li>记录下当前方法的每次调用环境现场</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tt -t demo.MathGame primeFactors</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626591019239.png" width="1626591019239"><ul><li><p>命令参数解析</p><ul><li><p><code>-t</code></p><p>tt 命令有很多个主参数，<code>-t</code> 就是其中之一。这个参数的表明希望记录下类 <code>*Test</code> 的 <code>print</code> 方法的每次执行情况。</p></li><li><p><code>-n 3</code></p><p>当你执行一个调用量不高的方法时可能你还能有足够的时间用 <code>CTRL+C</code> 中断 tt 命令记录的过程，但如果遇到调用量非常大的方法，瞬间就能将你的 JVM 内存撑爆。</p><p>此时你可以通过 <code>-n</code> 参数指定你需要记录的次数，当达到记录次数时 Arthas 会主动中断tt命令的记录过程，避免人工操作无法停止的情况。</p></li></ul></li><li><table><thead><tr><th align="left">表格字段</th><th align="center">字段解释</th></tr></thead><tbody><tr><td align="left">INDEX</td><td align="center">时间片段记录编号，每一个编号代表着一次调用，后续tt还有很多命令都是基于此编号指定记录操作，非常重要。</td></tr><tr><td align="left">TIMESTAMP</td><td align="center">方法执行的本机时间，记录了这个时间片段所发生的本机时间</td></tr><tr><td align="left">COST(ms)</td><td align="center">方法执行的耗时</td></tr><tr><td align="left">IS-RET</td><td align="center">方法是否以正常返回的形式结束</td></tr><tr><td align="left">IS-EXP</td><td align="center">方法是否以抛异常的形式结束</td></tr><tr><td align="left">OBJECT</td><td align="center">执行对象的<code>hashCode()</code>，注意，曾经有人误认为是对象在JVM中的内存地址，但很遗憾他不是。但他能帮助你简单的标记当前执行方法的类实体</td></tr><tr><td align="left">CLASS</td><td align="center">执行的类名</td></tr><tr><td align="left">METHOD</td><td align="center">执行的方法名</td></tr></tbody></table><ul><li><p>条件表达式</p><p>不知道大家是否有在使用过程中遇到以下困惑</p><ul><li><p>Arthas 似乎很难区分出重载的方法</p></li><li><p>我只需要观察特定参数，但是 tt 却全部都给我记录了下来</p><p>条件表达式也是用 <code>OGNL</code> 来编写，核心的判断对象依然是 <code>Advice</code> 对象。除了 <code>tt</code> 命令之外，<code>watch</code>、<code>trace</code>、<code>stack</code> 命令也都支持条件表达式。</p></li></ul></li><li><p>解决方法重载</p><p><code>tt -t *Test print params.length==1</code></p><p>通过制定参数个数的形式解决不同的方法签名，如果参数个数一样，你还可以这样写</p><p><code>tt -t *Test print &#39;params[1] instanceof Integer&#39;</code></p></li><li><p>解决指定参数</p><p><code>tt -t *Test print params[0].mobile==&quot;13989838402&quot;</code></p></li></ul></li></ul><ol start="2"><li><p>检索调用记录</p><p>当你用 <code>tt</code> 记录了一大片的时间片段之后，你希望能从中筛选出自己需要的时间片段，这个时候你就需要对现有记录进行检索。</p><p>假设我们有这些记录: tt -l</p><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626591664645.png" width="1626591664645"><p>我需要筛选出 <code>primeFactors</code> 方法的调用信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tt -s &#x27;method.name==&quot;primeFactors&quot;&#x27;</span><br></pre></td></tr></table></figure><p>你需要一个 <code>-s</code> 参数。同样的，搜索表达式的核心对象依旧是 <code>Advice</code> 对象。</p></li><li><p>查看调用信息</p><p>对于具体一个时间片的信息而言，你可以通过 <code>-i</code> 参数后边跟着对应的 <code>INDEX</code> 编号查看到他的详细信息。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tt -i 1003</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626591823165.png" width="1626591823165"></li><li><p>重新做一次调用</p><p>当你稍稍做了一些调整之后，你可能需要前端系统重新触发一次你的调用，此时得求爷爷告奶奶的需要前端配合联调的同学再次发起一次调用。而有些场景下，这个调用不是这么好触发的。</p><p><code>tt</code> 命令由于保存了当时调用的所有现场信息，所以我们可以自己主动对一个 <code>INDEX</code> 编号的时间片自主发起一次调用，从而解放你的沟通成本。此时你需要 <code>-p</code> 参数。通过 <code>--replay-times</code> 指定 调用次数，通过 <code>--replay-interval</code> 指定多次调用间隔(单位ms, 默认1000ms)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tt -i 1004 -p</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626591945850.png" width="1626591945850"><p>你会发现结果虽然一样，但调用的路径发生了变化，由原来的程序发起变成了 Arthas 自己的内部线程发起的调用了。</p><ul><li><p>需要强调的点</p><ol><li><p><strong>ThreadLocal 信息丢失</strong></p><p>很多框架偷偷的将一些环境变量信息塞到了发起调用线程的 ThreadLocal 中，由于调用线程发生了变化，这些 ThreadLocal 线程信息无法通过 Arthas 保存，所以这些信息将会丢失。</p><p>一些常见的 CASE 比如：鹰眼的 TraceId 等。</p></li><li><p><strong>引用的对象</strong></p><p>需要强调的是，<code>tt</code> 命令是将当前环境的对象引用保存起来，但仅仅也只能保存一个引用而已。如果方法内部对入参进行了变更，或者返回的对象经过了后续的处理，那么在 <code>tt</code> 查看的时候将无法看到当时最准确的值。这也是为什么 <code>watch</code> 命令存在的意义。</p></li></ol></li></ul></li></ol><h2 id="6-profiler"><a href="#6-profiler" class="headerlink" title="6. profiler"></a>6. profiler</h2><p><code>profiler</code> 命令支持生成应用热点的火焰图。本质上是通过不断的采样，然后把收集到的采样结果生成火焰图。</p><p><code>profiler</code> 命令基本运行结构是 <code>profiler action [actionArg]</code></p><h3 id="参数说明-3"><a href="#参数说明-3" class="headerlink" title="参数说明"></a>参数说明</h3><table><thead><tr><th align="center">参数名称</th><th align="center">参数说明</th></tr></thead><tbody><tr><td align="center"><em>action</em></td><td align="center">要执行的操作</td></tr><tr><td align="center"><em>actionArg</em></td><td align="center">属性名模式</td></tr><tr><td align="center">[i:]</td><td align="center">采样间隔（单位：ns）（默认值：10’000’000，即10 ms）</td></tr><tr><td align="center">[f:]</td><td align="center">将输出转储到指定路径</td></tr><tr><td align="center">[d:]</td><td align="center">运行评测指定秒</td></tr><tr><td align="center">[e:]</td><td align="center">要跟踪哪个事件（cpu, alloc, lock, cache-misses等），默认是cpu</td></tr></tbody></table><h3 id="开始采样"><a href="#开始采样" class="headerlink" title="开始采样"></a>开始采样</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">profiler start</span><br><span class="line"><span class="meta">[arthas@46284]$</span><span class="bash"> profiler start</span></span><br><span class="line">Started [cpu] profiling</span><br></pre></td></tr></table></figure><h3 id="获取已采集的sample的数量"><a href="#获取已采集的sample的数量" class="headerlink" title="获取已采集的sample的数量"></a>获取已采集的sample的数量</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">profiler getSamples</span><br><span class="line">$ profiler getSamples</span><br><span class="line">23</span><br></pre></td></tr></table></figure><h3 id="查看profiler状态"><a href="#查看profiler状态" class="headerlink" title="查看profiler状态"></a>查看profiler状态</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">profiler status</span><br><span class="line">$ profiler status</span><br><span class="line">[itimer] profiling is running for 4 seconds</span><br></pre></td></tr></table></figure><p>可以查看当前profiler在采样哪种<code>event</code>和采样时间。</p><h3 id="停止profiler"><a href="#停止profiler" class="headerlink" title="停止profiler"></a>停止profiler</h3><h4 id="生成svg格式结果"><a href="#生成svg格式结果" class="headerlink" title="生成svg格式结果"></a>生成svg格式结果</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">profiler stop</span><br><span class="line">profiler output file: /tmp/demo/arthas-output/20191125-135546.svg</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p>默认情况下，生成的结果保存到应用的<code>工作目录</code>下的<code>arthas-output</code>目录。可以通过 <code>--file</code>参数来指定输出结果路径。比如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">profiler stop --file /tmp/output.svg</span><br><span class="line">$ profiler stop --file /tmp/output.svg</span><br><span class="line">profiler output file: /tmp/output.svg</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h4 id="生成html格式结果"><a href="#生成html格式结果" class="headerlink" title="生成html格式结果"></a>生成html格式结果</h4><p>默认情况下，结果文件是<code>svg</code>格式，如果想生成<code>html</code>格式，可以用<code>--format</code>参数指定：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">profiler stop --format html</span><br><span class="line">$ profiler stop --format html</span><br><span class="line">profiler output file: /tmp/test/arthas-output/20191125-143329.html</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p>或者在<code>--file</code>参数里用文件名指名格式。比如<code>--file /tmp/result.html</code> 。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profiler stop --file /tmp/result.html</span><br></pre></td></tr></table></figure><img src="/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/1626595368642.png" width="1626595368642"><h4 id="火焰图的含义"><a href="#火焰图的含义" class="headerlink" title="火焰图的含义"></a>火焰图的含义</h4><p>火焰图是基于pref结果产生的SVG图片，用来展示CPU的调用栈。</p><p>y轴表示调用栈，每一层都是一个函数。调用栈越深，火焰就越高，顶部就是正在执行的函数，下方都是它的父函数。</p><p>x轴表示抽样数，如果一个函数在x轴占据的宽度越宽，就表示它被抽到的次数越多，即执行时间长。注意，x轴不代表时间，而是所有调用栈合并后，按照字母顺序排列的。</p><p><strong>火焰图就是看顶层的哪个函数占据的宽度最大。只要有“平顶”(plateaus)，就表示该函数可能存在性能问题。</strong>颜色没有特殊含义，以为火焰图表示的是CPU的繁忙程度，所以一般选择暖色调。</p></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://castile.github.io/2021/07/25/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E5%BC%80%E6%BA%90%E7%9A%84Java%E6%80%A7%E8%83%BD%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7Arthas%E8%AF%A6%E8%A7%A3/" title="阿里巴巴开源的Java性能诊断工具Arthas详解" target="_blank" rel="external">https://castile.github.io/2021/07/25/阿里巴巴开源的Java性能诊断工具Arthas详解/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/castile" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/castile" target="_blank"><span class="text-dark">朱宏梁</span><small class="ml-1x">Research &amp; Develop</small></a></h3><div>后端开发工程师</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2021/08/01/ZooKeeper1/" title="ZooKeeper的安装及其配置参数"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li><li class="next"><a href="/2021/07/23/lvo/" title="CVPR2017:Learning Video Object Segmentation with Visual Memory"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li><li class="toggle-toc"><a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button"><span>[&nbsp;</span><span>文章目录</span> <i class="text-collapsed icon icon-anchor"></i> <i class="text-in icon icon-close"></i> <span>]</span></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>感谢您的支持，我会继续努力的!</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipay.jpg" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/weixin.png" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/castile" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="https://gitee.com/hongliangzhu" target="_blank" title="Gitee" data-toggle="tooltip" data-placement="top"><i class="icon icon-gitee"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"RXHnFcNbbDpS4RzPQ4rf5KOC-gzGzoHsz",appKey:"OdMVqE4n2CdoeVAUG8bSTukn",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script><script>$(document).ready(function(){$("article img").not("[hidden]").not(".panel-body img").each(function(){var a,t,n=$(this),e=n.attr("alt"),r=n.parent("a");r.length<1&&(-1!=(t=(a=this.getAttribute("src")).lastIndexOf("?"))&&(a=a.substring(0,t)),r=n.wrap('<a href="'+a+'"></a>').parent("a")),r.attr("data-fancybox","images"),e&&r.attr("data-caption",e)}),$().fancybox({selector:'[data-fancybox="images"]',hash:!1,loop:!1})})</script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px;z-index:2}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>addLoadEvent(()=>{$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code")[0].innerText,n=document.createElement("textarea"),e=(document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus(),document.execCommand("copy"));document.body.removeChild(n),e?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})})</script></body></html>